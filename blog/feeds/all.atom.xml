<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>sys$notes</title><link href="http://fernandezcuesta.github.io/" rel="alternate"></link><link href="http://fernandezcuesta.github.io/feeds/all.atom.xml" rel="self"></link><id>http://fernandezcuesta.github.io/</id><updated>2015-04-24T11:47:27+02:00</updated><entry><title>Keep calm and setenforce 1 - SELinux notes</title><link href="http://fernandezcuesta.github.io/keep-calm-and-setenforce-1-selinux-notes.html" rel="alternate"></link><updated>2015-04-24T11:47:27+02:00</updated><author><name>J.M. Fernández</name></author><id>tag:fernandezcuesta.github.io,2015-04-24:keep-calm-and-setenforce-1-selinux-notes.html</id><summary type="html">&lt;h2&gt;&lt;span class="caps"&gt;GUI&lt;/span&gt; tool for SELinux:  &lt;strong&gt;&lt;code&gt;system-config-selinux&lt;/code&gt;&lt;/strong&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Files, folders, devices  → SELinux&amp;nbsp;objects&lt;/li&gt;
&lt;li&gt;Processes                → SELinux subjects    →    Both mapped in SELinux&amp;nbsp;contexts&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Processes are confined in their contexts.
Contexts define which files a process can access and which other processes can
interact&amp;nbsp;with.&lt;/p&gt;
&lt;h2&gt;Configuration file: &lt;strong&gt;&lt;code&gt;/etc/sysconfig/selinux&lt;/code&gt;&lt;/strong&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# This file controls the state of SELinux on the system.&lt;/span&gt;
&lt;span class="c"&gt;# SELINUX= can take one of these three values:&lt;/span&gt;
&lt;span class="c"&gt;#   enforcing - SELinux security policy is enforced.&lt;/span&gt;
&lt;span class="c"&gt;#   permissive - SELinux prints warnings instead of enforcing.&lt;/span&gt;
&lt;span class="c"&gt;#   disabled - SELinux is fully disabled.&lt;/span&gt;
&lt;span class="nv"&gt;SELINUX&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;enforcing
&lt;span class="c"&gt;# SELINUXTYPE= type of policy in use. Possible values are:&lt;/span&gt;
&lt;span class="c"&gt;#   targeted - Only targeted network daemons are protected.&lt;/span&gt;
&lt;span class="c"&gt;#   strict - Full SELinux protection.&lt;/span&gt;
&lt;span class="nv"&gt;SELINUXTYPE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;targeted
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Check current&amp;nbsp;mode:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; sestatus

&lt;span class="go"&gt;SELinux status:                 enabled&lt;/span&gt;
&lt;span class="go"&gt;SELinuxfs mount:                /selinux&lt;/span&gt;
&lt;span class="go"&gt;Current mode:                   permissive&lt;/span&gt;
&lt;span class="go"&gt;Mode from config file:          permissive&lt;/span&gt;
&lt;span class="go"&gt;Policy version:                 24&lt;/span&gt;
&lt;span class="go"&gt;Policy from config file:        targeted&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt; getenforce
&lt;span class="go"&gt;Enforcing&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Change the current&amp;nbsp;mode:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; setenforce &lt;span class="o"&gt;[&lt;/span&gt; Enforcing &lt;span class="p"&gt;|&lt;/span&gt; Permissive &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;&lt;span class="caps"&gt;USERS&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;Linux users are mapped into SELinux users (by default Linux users are
unconfined). To show the mapping,&amp;nbsp;run:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; semanage login -l
&lt;span class="go"&gt;Login Name           SELinux User         MLS/MCS Range        Service&lt;/span&gt;

&lt;span class="go"&gt;__default__          unconfined_u         s0-s0:c0.c1023       *&lt;/span&gt;
&lt;span class="go"&gt;root                 unconfined_u         s0-s0:c0.c1023       *&lt;/span&gt;
&lt;span class="go"&gt;system_u             system_u             s0-s0:c0.c1023       *&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Show SELinux confined users&amp;nbsp;parameters:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; semanage user -l
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Set SELinux rules for a specific&amp;nbsp;user:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; semanage login -s user_u -a one_user
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Set confined user as default for every new added&amp;nbsp;accounts:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; semanage login -m -S targeted -s &lt;span class="s2"&gt;&amp;quot;user_u&amp;quot;&lt;/span&gt; -r s0 __default__
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;&lt;span class="caps"&gt;BOOLEANS&lt;/span&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Show list of booleans with current and default status and short&amp;nbsp;description:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; semanage boolean -l

&lt;span class="gp"&gt;#&lt;/span&gt;  &lt;span class="c"&gt;# Only list of booleans with current status&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; getsebool -a
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Modify a SELinux boolean:
For example, in order to enable samba shares (&lt;code&gt;-P&lt;/code&gt; for&amp;nbsp;permanent):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; setsebool -P allow_smbd_anon_write on
&lt;span class="go"&gt;or&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; semanage boolean -m --on allow_smbd_anon_write
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;&lt;span class="caps"&gt;CONTEXTS&lt;/span&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;SELinux contexts for&amp;nbsp;processes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; ps -eZfx
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SELinux contexts for&amp;nbsp;users:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; id -Z
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SELinux contexts for&amp;nbsp;files:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; ls -lZ
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Change SELinux file&amp;nbsp;contexts&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;u&gt;Temporary changes&lt;/u&gt;: &lt;strong&gt;&lt;code&gt;chcon&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; chcon --reference /var/ftp /ftp
&lt;span class="gp"&gt;#&lt;/span&gt; chcon -R -u system_u -t public_content_rw_t /ftp
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;u&gt;&lt;em&gt;Where, as an example:&lt;/em&gt;&lt;/u&gt;
&lt;code&gt;public_content_rw_t&lt;/code&gt; allows uploads to an &lt;span class="caps"&gt;FTP&lt;/span&gt;&amp;nbsp;folder&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;u&gt;Permanent changes&lt;/u&gt;: &lt;strong&gt;&lt;code&gt;semanage fcontext&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; &lt;span class="c"&gt;#Adds a new record to the file contexts, but does not apply changes&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; semanage fcontext -a -t public_content_rw_t &lt;span class="s2"&gt;&amp;quot;/ftp(/.*)?&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; &lt;span class="c"&gt;#Restore contexts according to records, thus applying changes&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; restorecon -Rv /ftp
&lt;span class="gp"&gt;#&lt;/span&gt; ls -ldZ /ftp
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Unconfined&amp;nbsp;processes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; ls -Z /usr/sbin/httpd
&lt;span class="go"&gt;-rwxr-xr-x  root root system_u:object_r:httpd_exec_t:s0 /usr/sbin/httpd&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; chcon -t bin_t /usr/sbin/httpd
&lt;span class="gp"&gt;#&lt;/span&gt; ls -Z /usr/sbin/httpd
&lt;span class="go"&gt;-rwxr-xr-x. root root system_u:object_r:bin_t:s0       /usr/sbin/httpd&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Show all available SELinux&amp;nbsp;contexts&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; seinfo -t
&lt;span class="gp"&gt;#&lt;/span&gt; seinfo -t &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="s1"&gt;&amp;#39;^\s*ftp&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Restore SELinux&amp;nbsp;contexts&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Show default file&amp;nbsp;contexts:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; semanage fcontext -l
&lt;span class="gp"&gt;#&lt;/span&gt; restorecon -v -F -R /home/user/ftp
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;default file contexts are defined in &lt;code&gt;/etc/selinux/contexts/files/file_contexts&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Only show default SELinux context for a specific&amp;nbsp;folder/file&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; matchpathcon /var/www/html
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;&lt;span class="caps"&gt;FILES&lt;/span&gt;&lt;/h2&gt;
&lt;h3&gt;Mount filesystem with specific&amp;nbsp;context&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; mount -o &lt;span class="nv"&gt;context&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;system_u:object_r:httpd_sys_content_t:s0&amp;quot;&lt;/span&gt; server:/export /var/www/html/content
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;u&gt;&lt;em&gt;Options:&lt;/em&gt;&lt;/u&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-o context&lt;/code&gt;:    usually for removable media from non-SELinux systems (i.e. a
&lt;span class="caps"&gt;FAT32&lt;/span&gt; formatted &lt;span class="caps"&gt;USB&lt;/span&gt;&amp;nbsp;drive)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-o fscontext&lt;/code&gt;:  set or override the filesystem object instance security
context (i.e. set ext3 filesystem&amp;nbsp;security)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-o defcontext&lt;/code&gt;: set or override the default file security context (instead
of &lt;code&gt;default_t&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If the same directory of an export has to be mounted with diferent contexts,
use &lt;code&gt;-o nosharecache&lt;/code&gt; option.&lt;/p&gt;
&lt;h3&gt;Archiving files with extended&amp;nbsp;attributes&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; tar --selinux
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If extracting a tar file &lt;strong&gt;&lt;em&gt;without&lt;/em&gt;&lt;/strong&gt; extended attribute information,&amp;nbsp;do:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; tar -zxvf archive.tar.gz &lt;span class="p"&gt;|&lt;/span&gt; restorecon -f -
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;&lt;span class="caps"&gt;OTHER&lt;/span&gt;&lt;/h2&gt;
&lt;h3&gt;Copy files while preserving the context&amp;nbsp;information&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cp --preserve&lt;span class="o"&gt;=&lt;/span&gt;context source_file destination_file
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Add a custom port for a&amp;nbsp;service&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; semanage port -a -t http_port_t -p 10443
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Mounting filesystems with specific SELinux&amp;nbsp;contexts&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; mount server:/export /local/mount/point -o &lt;span class="nv"&gt;context&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;system_u:object_r:httpd_sys_content_t:s0&amp;quot;&lt;/span&gt;

&lt;span class="go"&gt;or in /etc/fstab&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt;server:/export /local/mount/ nfs &lt;span class="nv"&gt;context&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;system_u:object_r:httpd_sys_content_t:s0&amp;quot;&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; 0
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;&lt;span class="caps"&gt;TROUBLESHOOT&lt;/span&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt;  &lt;span class="c"&gt;# Search &amp;#39;qemu&amp;#39; related SELinux violations&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; ausearch -m avc -c qemu
&lt;span class="gp"&gt;#&lt;/span&gt;  &lt;span class="c"&gt;# Automatically generate a policy&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; ausearch -m avc -c qemu &lt;span class="p"&gt;|&lt;/span&gt; audit2allow -M mypol
&lt;span class="gp"&gt;#&lt;/span&gt; sealert  -a /var/log/audit/audit.log  &lt;span class="c"&gt;# (TUI)&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; sealert  &lt;span class="c"&gt;# (GUI)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Troubleshoot a specific&amp;nbsp;problem&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Reproduce the problem while watching the&amp;nbsp;logs:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; tail -f /var/log/audit/audit.log &lt;span class="p"&gt;|&lt;/span&gt; audit2why

&lt;span class="go"&gt;or&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt; tail -f /var/log/audit/audit.log &lt;span class="p"&gt;|&lt;/span&gt; audit2allow -a
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;In addition, as explained in
&lt;a href="http://www.certdepot.net/selinux-diagnose-policy-violations/"&gt;certdepot&lt;/a&gt;,
we can filter on the &lt;span class="caps"&gt;AVC&lt;/span&gt; as&amp;nbsp;follows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; tailf /var/log/audit/audit.log
&lt;span class="go"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;type=AVC msg=audit(1415714880.156:29): avc:  denied  { name_connect } for  pid=1349 \&lt;/span&gt;
&lt;span class="go"&gt;  comm=&amp;quot;nginx&amp;quot; dest=8080 scontext=unconfined_u:system_r:httpd_t:s0 \&lt;/span&gt;
&lt;span class="go"&gt;  tcontext=system_u:object_r:http_cache_port_t:s0 tclass=tcp_socket&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt; grep 1415714880.156:29 /var/log/audit/audit.log &lt;span class="p"&gt;|&lt;/span&gt; audit2why
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;If an output like this one is&amp;nbsp;shown:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;#============= httpd_sys_script_t ==============
allow httpd_sys_script_t self:capability { setuid setgid };
allow httpd_sys_script_t self:process setrlimit;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;proceed with flag &lt;code&gt;-M&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; tailf /var/log/audit/audit.log &lt;span class="p"&gt;|&lt;/span&gt; audit2allow -a -M my_semanage_file
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;And fix&amp;nbsp;with:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; semodule -i my_semanage_file.pp
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This process may be repeated several times to fully troubleshoot the&amp;nbsp;problem.&lt;/p&gt;
&lt;p&gt;If the &lt;code&gt;setroubleshoot-server&lt;/code&gt; is installed, some errors may appear directly
in the journal or in &lt;code&gt;/var/log/messages&lt;/code&gt; like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SELinux is preventing [...] run sealert -l 21d07129-dd4f-4ac7-9579-fd17e89f53ee
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/SELinux_Users_and_Administrators_Guide/index.html"&gt;&lt;span class="caps"&gt;RHEL7&lt;/span&gt; SELinux user&amp;rsquo;s and Administrator&amp;rsquo;s&amp;nbsp;Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.certdepot.net/selinux-diagnose-policy-violations/"&gt;Certdepot&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="linux"></category><category term="security"></category></entry><entry><title>A primer on DevOps agile tools - packer</title><link href="http://fernandezcuesta.github.io/a-primer-on-devops-agile-tools-packer.html" rel="alternate"></link><updated>2015-03-29T00:00:00+01:00</updated><author><name>J.M. Fernández</name></author><id>tag:fernandezcuesta.github.io,2015-03-29:a-primer-on-devops-agile-tools-packer.html</id><summary type="html">&lt;h3&gt;Pros:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Almost everything: automatization, high paralelysm, lot of customizable
elements,&amp;nbsp;&amp;hellip;&lt;/li&gt;
&lt;li&gt;Debug capabilities: defining an environmental variable &lt;code&gt;PACKER_LOG&lt;/code&gt;
with any value will redirect detailed log information to&amp;nbsp;stderr.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Cons (if&amp;nbsp;any):&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Some elements are&amp;rsquo;t too flexible. For example, with file provisioners we
cannot use wildcards, only individual files/directories can be copied to
the VMs. Not a big issue that can be circumvented in many&amp;nbsp;ways.&lt;/li&gt;
&lt;li&gt;If a postprocess error occurs the &lt;span class="caps"&gt;VM&lt;/span&gt; is deleted and the whole process must
be repeated from scratch. A nice to have default behaviour would be to allow
a resume operation (i.e. &lt;span class="caps"&gt;OS&lt;/span&gt; is installed, some packages were successfully
installedbut scripts are missing; resuming would retry from the last&amp;nbsp;stage).&lt;/li&gt;
&lt;li&gt;Vagrant postprocessor works copies the artifact to &lt;code&gt;/tmp&lt;/code&gt; before building
the box. While in most cases this is not a problem, I got several &lt;em&gt;no space
left&lt;/em&gt; errors when working on a system where &lt;code&gt;/tmp&lt;/code&gt; is a ramdisk and overall
memory usage is&amp;nbsp;high.&lt;/li&gt;
&lt;li&gt;Although this is clearly a vagrant issue, &lt;span class="caps"&gt;VM&lt;/span&gt; is reloaded (all changes are
rolled back to the state where packer&amp;rsquo;s postprocessor finished) if there&amp;rsquo;s
a problem with &lt;code&gt;vagrant up&lt;/code&gt;. There&amp;rsquo;s no chance for the user to fix the &lt;span class="caps"&gt;VM&lt;/span&gt;
before it is&amp;nbsp;reloaded.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Packer&amp;nbsp;template&lt;/h1&gt;
&lt;p&gt;The template for &lt;strong&gt;packer&lt;/strong&gt; is a &lt;span class="caps"&gt;JSON&lt;/span&gt; file containing several&amp;nbsp;sections.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Main section (&lt;code&gt;builders&lt;/code&gt;) where the &lt;span class="caps"&gt;VM&lt;/span&gt; is defined. In this case a local &lt;span class="caps"&gt;ISO&lt;/span&gt;
and kickstart files are specified and the artifacts (that is, what is
produced by &lt;strong&gt;packer&lt;/strong&gt;, is stored in &lt;code&gt;centos7-test&lt;/code&gt; folder. Only a builder for
&lt;span class="caps"&gt;QEMU&lt;/span&gt;/&lt;span class="caps"&gt;KVM&lt;/span&gt; is set in this example but we could build VMs for Docker, &lt;span class="caps"&gt;EC2&lt;/span&gt;,
VirtualBox, VMWare,&amp;nbsp;etc.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;provisioners&lt;/code&gt; section, where we can define how the &lt;span class="caps"&gt;VM&lt;/span&gt; will be provisioned
once the installation of the &lt;span class="caps"&gt;OS&lt;/span&gt; has ended. In other words, what additional
software needs to be installed and configured using either Puppet, Chef or
any other supported provisioner (see [https://www.packer.io/docs] for
more&amp;nbsp;information).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;post-processors&lt;/code&gt; section where we can say what to do with the&amp;nbsp;artifacts.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Example:&lt;/h1&gt;
&lt;p&gt;Over all possible scenarios, a Centos7 vagrant box will be installed starting
from the minimal &lt;span class="caps"&gt;ISO&lt;/span&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Additional software is provisioned by a shell script. Under the hood
autoprovisioning can also be defined straight into the kickstart file as
follows, but doing this may be redundant with the provisioner/s. In this
case an already existing kickstart file was&amp;nbsp;used.&lt;/li&gt;
&lt;li&gt;By default users &lt;code&gt;vagrant&lt;/code&gt; and &lt;code&gt;ssh&lt;/code&gt; have password set to &lt;code&gt;vagrant&lt;/code&gt; as
described in vagrant&amp;rsquo;s &lt;a href="http://docs.vagrantup.com/v2/boxes/base.html"&gt;base boxes specification&lt;/a&gt;.
Read 1st answer in &lt;a href="http://stackoverflow.com/questions/14715678/vagrant-insecure-by-default"&gt;stackoverflow&amp;rsquo;s discussion about vagrant
security&lt;/a&gt;
for further details about well-known&amp;nbsp;passwords.&lt;/li&gt;
&lt;li&gt;Artifact generated by the build stage (qcow2 hard disk file for &lt;span class="caps"&gt;KVM&lt;/span&gt;) isn&amp;rsquo;t
deleted when the postprocessor has ended (see &lt;strong&gt;&lt;em&gt;Cons&lt;/em&gt;&lt;/strong&gt;&amp;nbsp;above).&lt;/li&gt;
&lt;li&gt;For the kickstart file, optionally generate an encrypted password:&lt;div class="highlight"&gt;&lt;pre&gt;python -c &lt;span class="s1"&gt;&amp;#39;import crypt; print(crypt.crypt(&amp;quot;vagrant&amp;quot;))&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;packer&amp;nbsp;template&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;quot;builders&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;qemu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;iso_url&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http://ftp.udl.es/pub/centos/7.0.1406/isos/x86_64/CentOS-7.0-1406-x86_64-Minimal.iso&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;iso_checksum&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;e3afe3f1121d69c40cc23f0bafa05e5d&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;iso_checksum_type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;md5&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;output_directory&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;centos7-test&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;ssh_wait_timeout&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;30s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;shutdown_command&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;shutdown -P now&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;disk_size&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;5000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;qcow2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;headless&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;accelerator&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;kvm&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;http_directory&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;http_port_min&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;10082&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;http_port_max&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;10089&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;ssh_host_port_min&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2222&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;ssh_host_port_max&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2229&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;ssh_username&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;root&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;ssh_password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;vagrant&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;ssh_port&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;ssh_wait_timeout&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;90m&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;vm_name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;centos7&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;net_device&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;virtio-net&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;disk_interface&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;virtio&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;boot_wait&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;5s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;boot_command&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;&amp;lt;tab&amp;gt; text ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/centos7-ks.cfg&amp;lt;enter&amp;gt;&amp;lt;wait&amp;gt;&amp;quot;&lt;/span&gt;
      &lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;],&lt;/span&gt;

  &lt;span class="nt"&gt;&amp;quot;provisioners&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;shell&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;script&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;script.sh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;execute_command&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;echo &amp;#39;vagrant&amp;#39; | {{ .Vars }} sudo -E -S sh &amp;#39;{{ .Path }}&amp;#39;&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="p"&gt;],&lt;/span&gt;

  &lt;span class="nt"&gt;&amp;quot;post-processors&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;vagrant&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;compression_level&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;quot;keep_input_artifact&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;provisioner shell&amp;nbsp;script&lt;/h2&gt;
&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Add EPEL repository&lt;/span&gt;
yum install -y epel-release

&lt;span class="c"&gt;# Install git and clone remote repositories&lt;/span&gt;
&lt;span class="c"&gt;# Moved this to early stages to avoid nw outage due to reconfigurations&lt;/span&gt;
yum install -y git
git clone https://github.com/robbyrussell/oh-my-zsh.git /usr/share/oh-my-zsh
git clone https://github.com/fernandezcuesta/dotfiles.git

&lt;span class="c"&gt;# Install missing packages&lt;/span&gt;
yum install -y htop vim nano tmux setroubleshoot-server bash-completion python-psutil zsh
yum groupinstall -y &lt;span class="s2"&gt;&amp;quot;Basic Web Server&amp;quot;&lt;/span&gt;

&lt;span class="c"&gt;# Enable serial line output&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;GRUB_TERMINAL=\&amp;quot;console serial\&amp;quot;&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/default/grub
grubby --update-kernel&lt;span class="o"&gt;=&lt;/span&gt;ALL --args&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;console=ttyS0&amp;quot;&lt;/span&gt;

&lt;span class="c"&gt;# Add user for vagrant&lt;/span&gt;
useradd vagrant -G wheel

&lt;span class="c"&gt;# Put dotfiles in place&lt;/span&gt;
mv dotfiles/nanorc/* /usr/share/nano/
git clone https://github.com/gmarik/Vundle.vim.git dotfiles/.vim/bundle/Vundle.vim
cp -R dotfiles/.vim /root
cp -R dotfiles/.vim /home/vagrant
mv dotfiles/*.tmux /usr/local/bin
&lt;span class="k"&gt;for&lt;/span&gt; file in dotfiles/.*&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;[[&lt;/span&gt; -f &lt;span class="nv"&gt;$file&lt;/span&gt; &lt;span class="o"&gt;]]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; cp &lt;span class="nv"&gt;$file&lt;/span&gt; . &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; cp &lt;span class="nv"&gt;$file&lt;/span&gt; /home/vagrant&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;done&lt;/span&gt;
chown -R vagrant:vagrant /home/vagrant
rm -Rf dotfiles

&lt;span class="c"&gt;# Set zsh as default shell&lt;/span&gt;
chsh -s &lt;span class="sb"&gt;`&lt;/span&gt;which zsh&lt;span class="sb"&gt;`&lt;/span&gt;
chsh -s &lt;span class="sb"&gt;`&lt;/span&gt;which zsh&lt;span class="sb"&gt;`&lt;/span&gt; vagrant

&lt;span class="c"&gt;# Required by vagrant (http://docs.vagrantup.com/v2/boxes/base.html)&lt;/span&gt;
sed -i &lt;span class="s1"&gt;&amp;#39;s/^\(Defaults[[:space:]]\+requiretty\)/#&amp;amp;\t# required by vagrant/&amp;#39;&lt;/span&gt; /etc/sudoers
sed -i &lt;span class="s1"&gt;&amp;#39;s/!visiblepw/visiblepw\t# required by vagrant/&amp;#39;&lt;/span&gt; /etc/sudoers
sed -i &lt;span class="s1"&gt;&amp;#39;/#\+\s*Same thing without a password/a vagrant ALL=(ALL) NOPASSWD: ALL&amp;#39;&lt;/span&gt; /etc/sudoers
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;

&lt;h2&gt;Kickstart&amp;nbsp;file&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;install
cdrom
lang en_US.UTF-8
keyboard us
network --bootproto&lt;span class="o"&gt;=&lt;/span&gt;dhcp
authconfig --enableshadow --passalgo&lt;span class="o"&gt;=&lt;/span&gt;sha512
rootpw --iscrypted &lt;span class="nv"&gt;$6$RTzeoVEVyTLdKaVM$DTxJ&lt;/span&gt;/lov4/JUNrTVtJR0IMdnaeg1DYhi9FsnJdeEae32ewZKqKt9L0aHa51HEgsJnL24WVF6DG1gPMCGwrRBU/
firewall --enabled --service&lt;span class="o"&gt;=&lt;/span&gt;ssh
timezone GMT+1
unsupported_hardware
bootloader --location&lt;span class="o"&gt;=&lt;/span&gt;mbr
text
skipx

zerombr
clearpart --all --initlabel
part /boot --fstype&lt;span class="o"&gt;=&lt;/span&gt;ext4 --size&lt;span class="o"&gt;=&lt;/span&gt;256
part pv.01 --grow --size&lt;span class="o"&gt;=&lt;/span&gt;1
volgroup VolGroup --pesize&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4096&lt;/span&gt; pv.01
logvol / --fstype&lt;span class="o"&gt;=&lt;/span&gt;xfs --name&lt;span class="o"&gt;=&lt;/span&gt;lv_root --vgname&lt;span class="o"&gt;=&lt;/span&gt;VolGroup --grow --size&lt;span class="o"&gt;=&lt;/span&gt;1024
logvol swap --name&lt;span class="o"&gt;=&lt;/span&gt;lv_swap --vgname&lt;span class="o"&gt;=&lt;/span&gt;VolGroup --size&lt;span class="o"&gt;=&lt;/span&gt;2048

auth --useshadow --passalgo&lt;span class="o"&gt;=&lt;/span&gt;sha512
firstboot --disabled
reboot

%packages --nobase
@core
openssh-clients
sudo
&lt;span class="c"&gt;# unnecessary firmware&lt;/span&gt;
-aic94xx-firmware
-atmel-firmware
-b43-openfwwf
-bfa-firmware
-ipw2100-firmware
-ipw2200-firmware
-ivtv-firmware
-iwl100-firmware
-iwl1000-firmware
-iwl3945-firmware
-iwl4965-firmware
-iwl5000-firmware
-iwl5150-firmware
-iwl6000-firmware
-iwl6000g2a-firmware
-iwl6050-firmware
-libertas-usb8388-firmware
-ql2100-firmware
-ql2200-firmware
-ql23xx-firmware
-ql2400-firmware
-ql2500-firmware
-rt61pci-firmware
-rt73usb-firmware
-xorg-x11-drv-ati-firmware
-zd1211-firmware
&lt;span class="c"&gt;#&lt;/span&gt;
-nfs
-nfs-utils
-iscsi-initiator-utils
-bind
-sendmail
-fuse
-xorg-x11-drivers
-xorg-x11-server-Xorg
%end

%post
/usr/bin/yum -y update
%end
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Policy file allowing users in group wheel using libvirt&amp;nbsp;services&lt;/h2&gt;
&lt;p&gt;By adding the following policykit rule we can avoid being prompted for
credentials every time we do a &lt;code&gt;vagrant up&lt;/code&gt; or &lt;code&gt;vagrant ssh&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;[&lt;/span&gt;/etc/polkit-1/rules.d/49-vagrant.rules&lt;span class="o"&gt;]&lt;/span&gt;
polkit.addRule&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;function&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;action, subject&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;action.id &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;org.libvirt.unix.manage&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;
        subject.isInGroup&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wheel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt;
        &lt;span class="o"&gt;{&lt;/span&gt;
          &lt;span class="k"&gt;return&lt;/span&gt; polkit.Result.YES&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;})&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="agile"></category><category term="linux"></category><category term="internet"></category></entry><entry><title>Encrypted filesystem in Dropbox</title><link href="http://fernandezcuesta.github.io/encrypted-filesystem-in-dropbox.html" rel="alternate"></link><updated>2015-03-27T18:09:11+01:00</updated><author><name>J.M. Fernández</name></author><id>tag:fernandezcuesta.github.io,2015-03-27:encrypted-filesystem-in-dropbox.html</id><summary type="html">&lt;p&gt;The idea is to set up a container where we can put private/secret files.
A way to achieve this is setting up &lt;strong&gt;&lt;span class="caps"&gt;LUKS&lt;/span&gt;&lt;/strong&gt; on top of a fix-length file,
i.e. &lt;code&gt;~/Dropbox/private.img&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Initialization:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Initialize a (for example) &lt;span class="caps"&gt;100MB&lt;/span&gt;&amp;nbsp;file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/dev/urandom &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/tmp/private.img &lt;span class="nv"&gt;bs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;1M &lt;span class="nv"&gt;count&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;100
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Give format to the container while setting a&amp;nbsp;passphrase:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;cryptsetup luksFormat /tmp/private.img
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo cryptsetup open /tmp/private.img private
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo mkfs.ext4 -L Private /dev/mapper/private
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Mount and copy files to&amp;nbsp;it&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;mkdir /tmp/private
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo mount /dev/mapper/private /tmp/private
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo chown -R &lt;span class="sb"&gt;`&lt;/span&gt;whoami&lt;span class="sb"&gt;`&lt;/span&gt; /tmp/priv
&lt;span class="nv"&gt;$ &lt;/span&gt;cp ~/my_private_files/* /tmp/private
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Dismount and move the container to its final&amp;nbsp;location:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo umount /tmp/private
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo cryptsetup luksClose private
&lt;span class="nv"&gt;$ &lt;/span&gt;mv /tmp/private.img ~/Dropbox/private.img
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Configuration:&lt;/h2&gt;
&lt;p&gt;For this to be shown as a device, we can do the&amp;nbsp;following:&lt;/p&gt;
&lt;h3&gt;Option 1: using &lt;code&gt;/etc/rc.local&lt;/code&gt; systemd&amp;nbsp;compatibility&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;table class="highlight_inline_table"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="c"&gt;#!/bin/bash&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 2&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;IMG_LOCATION&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/home/user/Dropbox/private.img
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 3&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;$1&lt;/span&gt; in
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 4&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt; start&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 5&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt; &lt;span class="c"&gt;# start script&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 6&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt; losetup &amp;#8212;find &amp;#8212;show &lt;span class="nv"&gt;$IMG_LOCATION&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 7&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 8&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt; stop&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 9&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt; &lt;span class="c"&gt;# stop script&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;10&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt; losetup -d &lt;span class="sb"&gt;`&lt;/span&gt;losetup &lt;span class="p"&gt;|&lt;/span&gt; grep -Po &lt;span class="s2"&gt;&amp;#8220;.+(?=(\s+\d){4}.*&lt;/span&gt;&lt;span class="nv"&gt;$IMG_LOCATION&lt;/span&gt;&lt;span class="s2"&gt;)&amp;#8221;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;11&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;12&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;esac&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;13&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nb"&gt;exit&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To start this on every boot&amp;nbsp;do:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo chmod +x /etc/rc.local
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And ensure the unit file for &lt;code&gt;rc.local&lt;/code&gt; compatibility
(&lt;code&gt;/etc/systemd/system/rc-local.service&lt;/code&gt;) is enabled and&amp;nbsp;contains:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;[&lt;/span&gt;Unit&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/etc/rc.local Compatibility
&lt;span class="nv"&gt;ConditionPathExists&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/etc/rc.local

&lt;span class="o"&gt;[&lt;/span&gt;Service&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;Type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;forking
&lt;span class="nv"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/etc/rc.local start
&lt;span class="nv"&gt;ExecStop&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/etc/rc.local stop
&lt;span class="nv"&gt;TimeoutSec&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;0
&lt;span class="nv"&gt;StandardOutput&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;tty
&lt;span class="nv"&gt;RemainAfterExit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;yes
&lt;span class="nv"&gt;SysVStartPriority&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;99

&lt;span class="o"&gt;[&lt;/span&gt;Install&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;multi-user.target
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Option 2: systemd&amp;nbsp;unit&lt;/h3&gt;
&lt;p&gt;Create a systemd user unit file as follows under &lt;code&gt;/etc/systemd/system&lt;/code&gt;, for
example &lt;code&gt;/etc/systemd/system/mountloop.service&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;[&lt;/span&gt;Unit&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;Mount loop device
&lt;span class="nv"&gt;DefaultDependencies&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;no
&lt;span class="nv"&gt;Conflicts&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;umount.target
&lt;span class="nv"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;local&lt;/span&gt;-fs.target


&lt;span class="o"&gt;[&lt;/span&gt;Service&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;Type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;forking
&lt;span class="nv"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;IMG_LOCATION=/home/user/Dropbox/private.img&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/usr/sbin/losetup --find --show &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;IMG_LOCATION&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="nv"&gt;ExecStop&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/bin/bash -c &lt;span class="s2"&gt;&amp;quot;/usr/sbin/losetup -d `losetup | grep -Po \&amp;quot;.+(?=(\s+\d){4}.*&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;IMG_LOCATION&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;)\&amp;quot;`&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;TimeoutSec&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;0
&lt;span class="nv"&gt;RemainAfterExit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;yes

&lt;span class="o"&gt;[&lt;/span&gt;Install&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;default.target
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then enable this unit&amp;nbsp;file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo systemctl daemon-reload
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo systemctl &lt;span class="nb"&gt;enable &lt;/span&gt;mountloop
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo systemctl start mountloop
&lt;/pre&gt;&lt;/div&gt;</summary><category term="linux"></category><category term="internet"></category><category term="security"></category></entry><entry><title>OpenVMS system disk backup</title><link href="http://fernandezcuesta.github.io/openvms-system-disk-backup.html" rel="alternate"></link><updated>2015-01-05T00:00:00+01:00</updated><author><name>J.M. Fernández</name></author><id>tag:fernandezcuesta.github.io,2015-01-05:openvms-system-disk-backup.html</id><summary type="html">&lt;p&gt;Wrapper for doing automatic backups of the system unit (&lt;code&gt;DSA0:&lt;/code&gt;) in OpenVMS.
In a&amp;nbsp;nutshell:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It assumes that &lt;span class="caps"&gt;OS&lt;/span&gt; is installed in &lt;code&gt;DSA0:&lt;/code&gt; unit.&lt;/li&gt;
&lt;li&gt;This script is basically invoking the OpenVMS&amp;rsquo; &lt;code&gt;backup&lt;/code&gt; command.&lt;/li&gt;
&lt;li&gt;The resulting file is always stored locally (where configured) and transferred
via s/&lt;span class="caps"&gt;FTP&lt;/span&gt; to a remote &lt;span class="caps"&gt;SAN&lt;/span&gt;.&lt;/li&gt;
&lt;li&gt;Full and incremental/daily backups can be&amp;nbsp;done.&lt;/li&gt;
&lt;li&gt;Script takes care of housekeeping according to configured&amp;nbsp;values.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In order to safeguard against loss or corruption of relevant information of the
system, or to periodically archive copies of the most important (configuration)
files, a backup of the data is needed. The resulting archives may be used to
recover the original information after a disaster (for example if system disk is
damaged), or to restore data from an earlier&amp;nbsp;time.&lt;/p&gt;
&lt;p&gt;OpenVMS provides several ways to backup files, being the embedded backup tool
the most powerful and widely used. Using this tool an operator&amp;nbsp;can:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Make image backups of a unit (snapshots of the whole content of a disk
volume). In the case of the system unit, the bootstrap data is saved in the&amp;nbsp;archive.&lt;/li&gt;
&lt;li&gt;Make file based backups (archive of selected folders and files). No bootstrap
data is usually saved in file based&amp;nbsp;backups.&lt;/li&gt;
&lt;li&gt;Optionally a &lt;span class="caps"&gt;DB&lt;/span&gt; backup (Oracle &lt;span class="caps"&gt;RDB&lt;/span&gt; or Mimer) will be done online into a file
saved in system unit (inside &lt;code&gt;DSA0:[BACKUP]&lt;/code&gt; folder). In some systems, this &lt;span class="caps"&gt;DB&lt;/span&gt;
already resides in the system unit and this step is not necessary (but may be&amp;nbsp;forced).&lt;/li&gt;
&lt;li&gt;No other data is backed&amp;nbsp;up.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In order to speed the process up and minimize the impact on size and bandwidth
needed to store and transfer the resulting archives into the data warehouse,
it is recommended to keep the system unit&amp;nbsp;clean.&lt;/p&gt;
&lt;p&gt;The procedure described in the following chapters defines how to make a backup
of the system volume to a separate disk, and how to roll back in case of the
system disk needs to be restored to a previous state.
In the following examples, a full backup of the system volume to the spare &lt;span class="caps"&gt;SAS&lt;/span&gt;
disk &lt;code&gt;DKA200&lt;/code&gt; is done, together with it an online backup of the&amp;nbsp;database.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;u&gt;&lt;span class="caps"&gt;NOTE&lt;/span&gt;&lt;/u&gt;:&lt;/strong&gt; The spare disk available for the backup might be different
from &lt;code&gt;DKA200&lt;/code&gt; as used for the examples. Please adjust according to your system’s&amp;nbsp;configuration.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Later on, the opposite operation for restoring data from a backup archive will
be described, as well as some troubleshooting guidelines on booting from a
minimal OpenVMS unit (referred to as emergency&amp;nbsp;boot).&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;span class="caps"&gt;IMPORTANT&lt;/span&gt;&lt;/strong&gt;: The backup procedures are to be executed with the same user
(i.e. &lt;span class="caps"&gt;SYSTEM&lt;/span&gt;) as specified for each&amp;nbsp;command.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;1.&amp;nbsp;Preparations&lt;/h1&gt;
&lt;h2&gt;1.1 Prepare target&amp;nbsp;disk&lt;/h2&gt;
&lt;p&gt;The target disk can be either one of the local &lt;span class="caps"&gt;SAS&lt;/span&gt; disks on each node or a
shared disk from the &lt;span class="caps"&gt;SAN&lt;/span&gt;. If the target disk is not bootable, proceed as
follows. It is also possible to use a &lt;strong&gt;&lt;span class="caps"&gt;LD&lt;/span&gt; device&lt;/strong&gt; as&amp;nbsp;destination.&lt;/p&gt;
&lt;p&gt;Initialize the disk and make it bootable (will delete all its contents!).
Do not use any reserve word as system label (i.e. &lt;code&gt;backup&lt;/code&gt; or any other known
command). Refer to &lt;strong&gt;Troubleshooting&lt;/strong&gt; chapter for further&amp;nbsp;details.&lt;/p&gt;
&lt;p&gt;Destination volume must be initialized and&amp;nbsp;mounted:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Alpha:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; INITIALIZE /NOHIGH/cluster=16/extension=256/header=8000 DKA200: BCK_DSK
SYSTEM&amp;gt; MOUNT /OVERRIDE=IDENTIFICATION DKA200
SYSTEM&amp;gt; @SYS$SYSTEM:AXPVMS$PCSI_INSTALL_MIN
Enter device name for target disk: (? for choices) DKA200
Do you want to create &lt;span class="nb"&gt;or &lt;/span&gt;validate boot options? (Yes/No) Yes
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Itanium:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; INITIALIZE /NOHIGH/cluster=64/extension=256/header=8000 DKA200: BCK_DSK
SYSTEM&amp;gt; MOUNT /OVERRIDE=IDENTIFICATION DKA200
SYSTEM&amp;gt; @SYS$SYSTEM:I64VMS$PCSI_INSTALL_MIN
Enter device name for target disk: (? for choices) DKA200
Do you want to create &lt;span class="nb"&gt;or &lt;/span&gt;validate boot options? (Yes/No) Yes
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If the destination disk is labeled &lt;code&gt;BCK_DSK&lt;/code&gt;, the script will automatically put
the backup archives inside a &lt;code&gt;BACKUP&lt;/code&gt; directory in it. This is the easiest way
to proceed when working with local disks: units should have the same name from
every node in the cluster, even if they are not labeled or identified the same
(for example, disks located in different bay numbers will get different&amp;nbsp;naming).&lt;/p&gt;
&lt;p&gt;If there is an already initialized unit in place, this same behaviour can be
achieved by setting a logical name pointing to its&amp;nbsp;label.&lt;/p&gt;
&lt;p&gt;This logical name definition may be added to &lt;code&gt;sys$startup:sylogicals.com&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;The logical must be defined &lt;strong&gt;on each node in the cluster&lt;/strong&gt;. It is very
important to use the translation_attribute qualifier as well as the ending &amp;lsquo;:&amp;rsquo;
sign in the target unit. For&amp;nbsp;example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; define /translation_attributes=conceal /system /exec BCK_DSK DAT0:
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Finally, copy the &lt;span class="caps"&gt;ZIP&lt;/span&gt; and &lt;span class="caps"&gt;UNZIP&lt;/span&gt; binaries to the emergency disk as&amp;nbsp;follows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; &lt;span class="nb"&gt;copy &lt;/span&gt;/log *ZIP.EXE DKA200:[000000]
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;u&gt;Note&lt;/u&gt;:&lt;/strong&gt; doublecheck that the versions of &lt;span class="caps"&gt;ZIP&lt;/span&gt; and &lt;span class="caps"&gt;UNZIP&lt;/span&gt; are supported as
explained in&amp;nbsp;1.3.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;1.2 System disk&amp;nbsp;cleanup&lt;/h2&gt;
&lt;p&gt;To speed up the overall process, it is recommended to first clean up the system
disk by purging unnecessary files. As an example, purge files with extension
log or tmp older than one week and look for files larger than 100000 blocks
(5 &lt;span class="caps"&gt;MB&lt;/span&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; purge /log dsa0:[000000...]*.log,*.tmp /keep=7
SYSTEM&amp;gt; MC DFU search /size=minimum=10000 dsa0
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;You may also set some backups which don&amp;rsquo;t need to be backed up with the
following&amp;nbsp;command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; &lt;span class="nb"&gt;set &lt;/span&gt;file /nobackup sys$system:pagefile.sys
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;1.3 Required third-party&amp;nbsp;tools&lt;/h2&gt;
&lt;p&gt;Verify on the system that the &lt;span class="caps"&gt;ZIP&lt;/span&gt; and &lt;span class="caps"&gt;UNZIP&lt;/span&gt; tools are installed and its versions
are newer or equal than those specified below. These versions are needed to pack
files &amp;gt;&lt;span class="caps"&gt;2GB&lt;/span&gt; in &lt;span class="caps"&gt;UNIX&lt;/span&gt; compatible&amp;nbsp;format.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ZIP.EXE&lt;/code&gt; v3.0 or&amp;nbsp;higher&lt;/li&gt;
&lt;li&gt;&lt;code&gt;UNZIP.EXE&lt;/code&gt; v6.0 or&amp;nbsp;higher&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To verify which version is&amp;nbsp;installed:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; &lt;span class="nb"&gt;zip&lt;/span&gt;
Copyright (c) 1990-2008 Info-ZIP &lt;span class="nb"&gt;- &lt;/span&gt;Type &amp;#39;zip &lt;span class="s"&gt;&amp;quot;-L&amp;quot;&lt;/span&gt;&amp;#39; for software license.
Zip &lt;span class="m"&gt;3.0 &lt;/span&gt;(July 5th 2008). Usage: &lt;span class="nb"&gt;zip &lt;/span&gt;== &lt;span class="s"&gt;&amp;quot;$ disk:[dir]zip.exe&amp;quot;&lt;/span&gt;

SYSTEM&amp;gt; &lt;span class="nb"&gt;unzip&lt;/span&gt;
UnZip &lt;span class="m"&gt;6.00 &lt;/span&gt;&lt;span class="nb"&gt;of &lt;/span&gt;&lt;span class="m"&gt;20 &lt;/span&gt;April 2009, by Info-ZIP. For more details see: &lt;span class="nb"&gt;unzip &lt;/span&gt;-v.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Latest versions can be downloaded from
&lt;a href="ftp://ftp.info-zip.org/pub/infozip/vms/"&gt;ftp.info-zip.org/pub/infozip/vms/&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;1.4 Export &lt;span class="caps"&gt;SSH&lt;/span&gt; public&amp;nbsp;key&lt;/h2&gt;
&lt;p&gt;If it is planned to send the resulting file to a remote server using &lt;span class="caps"&gt;SFTP&lt;/span&gt; with
public key authentication as transference method, the public key of the system
has to be sent to the remote server. First of all, ensure that public-key
authentication is allowed by the &lt;span class="caps"&gt;SSH&lt;/span&gt; client on configuration file
&lt;code&gt;TCPIP$SSH_DEVICE:[TCPIP$SSH.ssh2]ssh2_config.&lt;/code&gt; by looking for the value of
&lt;code&gt;AllowedAuthentications&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Then identify the key that the client will use by&amp;nbsp;doing:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;type sys$login:[ssh2]identification.
IdKey ID_DSA_2048_A
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If there are no IdKey entries, generate a new key pair with the following
command. Bear in mind that OpenVMS&amp;rsquo; secure shell is based on &lt;span class="caps"&gt;SSH2&lt;/span&gt; and the key
format differs from&amp;nbsp;OpenSSH.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;ssh_keygen -P mykey
&lt;span class="nb"&gt;&amp;gt; set &lt;/span&gt;file /protection=(S,W,G,O:RW) mykey
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Add the following entry to &lt;code&gt;IDENFITICATION.&lt;/code&gt; file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;    [IDENTIFICATION.]
    IdKey mykey
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Finally, transfer the &lt;code&gt;mykey.pub&lt;/code&gt; file to the remote system and add it to the
authorization&amp;nbsp;file.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;OpenVMS (&lt;span class="caps"&gt;SSH2&lt;/span&gt;)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;SET FILE/PROTECTION=(S:WRED,O:WRED,G:RE,W:R) mykey.pub
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Add the following entry to the &lt;code&gt;[.ssh2]authorized.&lt;/code&gt; file under &lt;code&gt;sys$login&lt;/code&gt;
  directory:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;IdKey mykey.pub
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Unix&amp;nbsp;(OpenSSH) &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;$&lt;/span&gt; ssh-keygen -i -f mykey.pub &amp;gt;&amp;gt; ~/.ssh/authorized_keys
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;2. Creating the backup&amp;nbsp;manually&lt;/h1&gt;
&lt;p&gt;If the subscribers database (&lt;span class="caps"&gt;SDB&lt;/span&gt;) resides on the system disk, skip this step.
Otherwise, create a Backup directory which will store the &lt;span class="caps"&gt;RDB&lt;/span&gt; backup&amp;nbsp;file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; create /directory dsa0:[backup]
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;2.1 Perform a manual backup of the&amp;nbsp;database&lt;/h2&gt;
&lt;p&gt;You may skip this step if the subscriber database already resides in the system
unit (&lt;code&gt;dsa0:&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Databases can be backed up online (without service interruption)
directly from the command line as follows. In this example, it will be saved on
&lt;code&gt;dsa0:[backup]&lt;/code&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;For Oracle &lt;span class="caps"&gt;RDB&lt;/span&gt;&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; RMU /backup/online db_logical_name dsa0:[backup]database_backup.rbf
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;For Mimer &lt;span class="caps"&gt;DB&lt;/span&gt;&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; @sbr$root:[scripts]bck_mimer_rdb dsa0:[backup]database_backup.bck
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;2.2 Perform a manual backup of the system&amp;nbsp;unit&lt;/h2&gt;
&lt;p&gt;Backups can be done directly from the command prompt as follows. In this
example, dsa0 content will be backed up into &lt;code&gt;dat0:[backup]fulldsa0.bck&lt;/code&gt; file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; backup /record/log/ignore=interlock/image/label=MANUAL_BCK dsa0:
_SYSTEM&amp;gt; dat0:[backup]fulldsa0.bck /save_set
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Save only the most recent version of&amp;nbsp;files:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; backup /record/log/ignore=interlock/image/label=LAST_VERS &lt;span class="nb"&gt;-&lt;/span&gt;
_SYSTEM&amp;gt; dsa0:[000000...]*.*; dat0:[backup]dsa0_lastv.bck /save_set
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Backup operation progress can be checked in the interactive session by pressing
&lt;code&gt;Ctrl-T&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Additionally on newer OpenVMS versions (≥8.x) platforms, a compression
filter (&lt;code&gt;zlib&lt;/code&gt;) can be applied while archiving the files by adding the
&lt;code&gt;/data_format=compress&lt;/code&gt; qualifier to the&amp;nbsp;command.&lt;/p&gt;
&lt;h1&gt;3. Running the backup&amp;nbsp;automatically&lt;/h1&gt;
&lt;h2&gt;3.1 Script&amp;nbsp;configuration&lt;/h2&gt;
&lt;p&gt;Configuration for the backup script is stored in &lt;code&gt;BACKUP_CONFIG.DAT&lt;/code&gt; file, which
should be placed in the same directory as the script (by default
&lt;code&gt;DSA0:[BACKUP]&lt;/code&gt;).
If not present or empty records, default values are coded in the&amp;nbsp;scripts.&lt;/p&gt;
&lt;p&gt;See Appendix C for the settings file&amp;nbsp;content.&lt;/p&gt;
&lt;h2&gt;3.2 Backup&amp;nbsp;script&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;@dsa0:[backup]sys_backup [NOW]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If run without parameters, it will assume that the backup will be performed next
&lt;code&gt;Backup_day&lt;/code&gt; at &lt;code&gt;Backup_hour&lt;/code&gt; and will not resubmit&amp;nbsp;itself.&lt;/p&gt;
&lt;p&gt;With the optional parameter &lt;code&gt;NOW&lt;/code&gt;, the script will schedule itself (almost)
immediately with the settings configured in the &lt;code&gt;BACKUP_CONFIG.DAT&lt;/code&gt; file.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;u&gt;Note&lt;/u&gt;:&lt;/strong&gt;: The script is scheduled with lower priority (3) than other
applications; this means the backup will process if the system is not busy with
higher priority tasks. At high load, backup may take longer than expected.
It is recommended to set the backup time somewhere in the interval between
&lt;span class="caps"&gt;02AM&lt;/span&gt; and &lt;span class="caps"&gt;06AM&lt;/span&gt;, since this is typically the interval with lower&amp;nbsp;load.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;3.3 Scheduling the backup&amp;nbsp;automatically&lt;/h2&gt;
&lt;p&gt;If run with&amp;nbsp;parameter:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;p1: Auto-submission&amp;nbsp;(Yes/No)&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It will wait for next &lt;code&gt;Backup_day&lt;/code&gt; at &lt;code&gt;Backup_hour&lt;/code&gt; to run (those two parameters
are customizable in the script, by default next Monday &lt;span class="caps"&gt;02AM&lt;/span&gt;). If &lt;code&gt;p1&lt;/code&gt; is set to
&amp;lsquo;Yes&amp;rsquo;, it will be resubmitted automatically every &lt;code&gt;Backup_day&lt;/code&gt; at &lt;code&gt;Backup_hour&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;For&amp;nbsp;example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;@dsa0:[backup]SYS_BACKUP Yes
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Another option is to configure the desired value in the configuration&amp;nbsp;file.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Configuration item: &lt;span class="caps"&gt;RESCHEDULE&lt;/span&gt;&amp;nbsp;(Yes,[No])&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;3.4 Incremental daily&amp;nbsp;backups&lt;/h2&gt;
&lt;p&gt;While having a weekly backup (or any other periodicity) it is also possible to
have incremental backups with shorter period, such as daily&amp;nbsp;backups.&lt;/p&gt;
&lt;p&gt;If run with&amp;nbsp;parameter:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;p2: Incremental&amp;nbsp;(Yes/No)&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It can be specified that the backup to be performed is incremental
(default: full backup).
If set to do an incremental backup but no full backup was done before, then a
full backup is made instead.
When auto-submission is set, it will assume that a full backup will be done in
a weekly basis (the day of the week when full backup is scheduled) while
incremental backups are made the other days of the week. For&amp;nbsp;example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;u&gt;Note&lt;/u&gt;:&lt;/strong&gt;: the first parameter in this example was set to “default”.
In that case, it will look for a valid value in the configuration file, or set
the coded default value if not&amp;nbsp;present.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;@dsa0:[backup]SYS_BACKUP default YES
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;Configuration item: &lt;span class="caps"&gt;INCREMENTAL&lt;/span&gt;&amp;nbsp;(Yes,[No])&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;3.5 File transference&amp;nbsp;method&lt;/h2&gt;
&lt;p&gt;Once the backup is finished, the resulting archive can be sent to an external
storage. Transference methods include &lt;span class="caps"&gt;FTP&lt;/span&gt; and &lt;span class="caps"&gt;SFTP&lt;/span&gt;, while the file can be also
left as a &lt;span class="caps"&gt;ZIP&lt;/span&gt; archive to be pulled from an external system via any protocol that
the host may accept (i.e. &lt;span class="caps"&gt;SCP&lt;/span&gt;, &lt;span class="caps"&gt;RCP&lt;/span&gt;, s/&lt;span class="caps"&gt;FTP&lt;/span&gt;,&amp;nbsp;&amp;hellip;).&lt;/p&gt;
&lt;p&gt;This can be achieved by specifying a third&amp;nbsp;parameter:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;p3: File transfer {&lt;span class="caps"&gt;FTP&lt;/span&gt;, &lt;span class="caps"&gt;SFTP&lt;/span&gt;, &lt;span class="caps"&gt;PULL&lt;/span&gt;=None}&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Example:&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;@dsa0:[backup]SYS_BACKUP default default SFTP
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;3.6 Customized backup&amp;nbsp;location&lt;/h2&gt;
&lt;p&gt;By default, script will look at drive labeled (or referred with a logical name)
as &lt;code&gt;BCK_DSK&lt;/code&gt;. However, a customized location may be specified rather than the
coded&amp;nbsp;one.&lt;/p&gt;
&lt;p&gt;If run with&amp;nbsp;parameter:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;p4: Backup location (BCK_DSK:[&lt;span class="caps"&gt;BACKUP&lt;/span&gt;])&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then the backup will be performed in the specified directory. An example of
specifying a destination folder&amp;nbsp;follows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;@dsa0:[backup]SYS_BACKUP default default default DSA1:[BACKUP.DSA0BCK]
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;3.7 Exclude files from being backed&amp;nbsp;up&lt;/h2&gt;
&lt;p&gt;It is possible (but not recommended as will be explained) for the operator to
discard some files that are not needed to store into a backup archive. For
example, some log files or temporary installation directories may be excluded
from being&amp;nbsp;saved.&lt;/p&gt;
&lt;p&gt;Doing this allows smaller archive files and faster backup process. However, it
is important to bear in mind some limitations when working with exclusion lists:
Image backup (directly bootable once restored) is not possible. Instead, all
files rather than those in the exclusion lists are copied, but boot block is not
saved inside the archive. Thus, the resulting image will not be bootable once
it is restored in a real&amp;nbsp;disk.&lt;/p&gt;
&lt;p&gt;Overall recovery process is significantly slower and more complex due to boot
block recovery (which is lost during the&amp;nbsp;backup).&lt;/p&gt;
&lt;p&gt;When restoring the file-system, follow the procedures explained in “Restore
system disk from a non-image backup” and “Restore system disk from image backup”
depending on whether or not an exclusion list was used or not&amp;nbsp;respectively.&lt;/p&gt;
&lt;h1&gt;4. Operations with backup archive&amp;nbsp;files&lt;/h1&gt;
&lt;h2&gt;4.1 Show files stored in a backup&amp;nbsp;archive&lt;/h2&gt;
&lt;p&gt;It is possible to show the list of files archived inside a backup save&amp;nbsp;set.&lt;/p&gt;
&lt;p&gt;This list can be optionally redirected to a file for future usage (&lt;code&gt;FILES.LIS&lt;/code&gt;
in the example), and details can also be expanded with &lt;code&gt;/FULL&lt;/code&gt; qualifier.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;BACKUP /LIST[=FILES.LIS] BCK_DSK:[BACKUP]SYSIMAGE.BCK /SAVE_SET [/FULL]
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;4.2 Extract files from a backup&amp;nbsp;archive&lt;/h2&gt;
&lt;p&gt;In order to extract a file of directory from the archive, a selection (filespec)
and destination must be specified as&amp;nbsp;follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Restoring a single&amp;nbsp;file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;BACKUP BCK_DSK:[BACKUP]SYSIMAGE.BCK /SAVE_SET /SELECT=index.dat dsa0:[stats]index.dat
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Restoring several&amp;nbsp;files:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;BACKUP BCK_DSK:[BACKUP]SYSIMAGE.BCK /SAVE_SET /log /SELECT=[scripts]*.com dsa:[scripts]
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Restoring a full&amp;nbsp;directory:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;BACKUP BCK_DSK:[BACKUP]SYSIMAGE.BCK /SAVE_SET /log /SELECT=[django...] dsa0:[django...]
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Restore files from a specific user (&lt;span class="caps"&gt;UIC&lt;/span&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;BACKUP BCK_DSK:[BACKUP]SYSIMAGE.BCK /SAVE_SET /log /BY_OWNER=[300,102] dsa0:[user2_files]
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;4.3&amp;nbsp;vmsbackup&lt;/h2&gt;
&lt;p&gt;If the archive is residing in a Linux, Mac &lt;span class="caps"&gt;OS&lt;/span&gt;, Solaris or other Unix-like
system, it is also possible to show and extract files from an archive with the
&lt;a href="http://labs.hoffmanlabs.com/node/817"&gt;vmsbackup&lt;/a&gt;&amp;nbsp;tool.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;$&lt;/span&gt; vmsbackup
&lt;span class="go"&gt;Usage: vmsbackup -{tx}[cdevwF][-b blocksize][-s setnumber][-f tapefile] &lt;/span&gt;
&lt;span class="go"&gt;Version 4.4.3 &lt;/span&gt;
&lt;span class="go"&gt;Reads and optionally unpacks OpenVMS BACKUP savesets&lt;/span&gt;


&lt;span class="go"&gt;Available switches: &lt;/span&gt;
&lt;span class="go"&gt; -b --blocksize Use specified blocksize &lt;/span&gt;
&lt;span class="go"&gt; -B --binary Extract as binary files &lt;/span&gt;
&lt;span class="go"&gt; -c --complete Retain complete filename &lt;/span&gt;
&lt;span class="go"&gt; -d --directory Create subdirectories &lt;/span&gt;
&lt;span class="go"&gt; -e --extension Extract all files &lt;/span&gt;
&lt;span class="go"&gt; -f --file Read from file &lt;/span&gt;
&lt;span class="go"&gt; -F --full Full detail in listing &lt;/span&gt;
&lt;span class="go"&gt; -s --saveset Read saveset number &lt;/span&gt;
&lt;span class="go"&gt; -t --list List files in saveset &lt;/span&gt;
&lt;span class="go"&gt; -v --verbose List files as they are processed &lt;/span&gt;
&lt;span class="go"&gt; -V --version Show program version number &lt;/span&gt;
&lt;span class="go"&gt; -w --confirm Confirm files before restoring &lt;/span&gt;
&lt;span class="go"&gt; -x --extract Extract files &lt;/span&gt;
&lt;span class="go"&gt; -? --help Display this help message&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Some examples of vmsbackup usage&amp;nbsp;follow.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;$&lt;/span&gt; vmsbackup -tf archive.bck &lt;span class="c"&gt;# list files in an archive&lt;/span&gt;
&lt;span class="go"&gt;Save set: ARCHIVE.BCK &lt;/span&gt;
&lt;span class="go"&gt;Written by: USER &lt;/span&gt;
&lt;span class="go"&gt;UIC: [000100,000001] &lt;/span&gt;
&lt;span class="go"&gt;Date: 30-Jul-2013 20:07:53 &lt;/span&gt;
&lt;span class="go"&gt;Command: BACKUP/LOG/IGNORE=INTERLOCK DSA2:[FILES...]*.* ARCHIVE.BCK /SAVE _SET&lt;/span&gt;
&lt;span class="go"&gt;Operating system: OpenVMS I64 version V8.3 &lt;/span&gt;
&lt;span class="go"&gt;BACKUP version: V8.3-1H1 &lt;/span&gt;
&lt;span class="go"&gt;CPU ID register: 80000000 &lt;/span&gt;
&lt;span class="go"&gt;Node name: _SMXXNN:: &lt;/span&gt;
&lt;span class="go"&gt;Written on: _DSA0: &lt;/span&gt;
&lt;span class="go"&gt;Block size: 32256 &lt;/span&gt;
&lt;span class="go"&gt;Group size: 10 &lt;/span&gt;
&lt;span class="go"&gt;Buffer count: 4353&lt;/span&gt;


&lt;span class="go"&gt;[FILES]MY_LARGE_DB.DAT;2 432346347 19-Nov-2010 18:11:13 &lt;/span&gt;
&lt;span class="go"&gt;[FILES]INFO.TXT;5 654 14-Jan-2011 11:21:04&lt;/span&gt;
&lt;span class="go"&gt;[FILES]EDIT.EXE;1 15698 02-Feb-2013 17:54:23&lt;/span&gt;


&lt;span class="gp"&gt;$&lt;/span&gt; vmsbackup -tFf archive.bck info.txt &lt;span class="c"&gt;# show extended file information&lt;/span&gt;
&lt;span class="go"&gt;Save set: ARCHIVE.BCK &lt;/span&gt;
&lt;span class="go"&gt;[...]&lt;/span&gt;


&lt;span class="go"&gt;[SYSMGR]INFO.TXT;1 &lt;/span&gt;
&lt;span class="go"&gt;Size: 1/16 Created: 19-Nov-2010 18:11:13&lt;/span&gt;
&lt;span class="go"&gt;Owner: [000001,000004] Revised: 19-Nov-2010 18:11:13 (3) &lt;/span&gt;
&lt;span class="go"&gt;File ID: (3971,1,1) Expires: 01-Jan-1970 01:00:00 &lt;/span&gt;
&lt;span class="go"&gt; Backup: 01-Jan-1970 01:00:00 &lt;/span&gt;
&lt;span class="go"&gt;Protection: (S:RWED,O:RWED,G:RE,W:RE) &lt;/span&gt;
&lt;span class="go"&gt;File Organization: Sequential &lt;/span&gt;
&lt;span class="go"&gt;File attributes: Allocation 16, Extend 0 &lt;/span&gt;
&lt;span class="go"&gt;Record format: Variable length, maximum 57 bytes &lt;/span&gt;
&lt;span class="go"&gt;Record attributes: Carriage return carriage control&lt;/span&gt;



&lt;span class="gp"&gt;$&lt;/span&gt; vmsbackup -dxevf archive.bck  &lt;span class="c"&gt;# extract all files from an archive&lt;/span&gt;


&lt;span class="gp"&gt;$&lt;/span&gt; vmsbackup -Bdxvf archive.bck edit.exe &lt;span class="c"&gt;# extract binary (B) file from an archive&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;4.4 &lt;span class="caps"&gt;VMS&lt;/span&gt; Backup reader&amp;nbsp;(VMSBackup)&lt;/h2&gt;
&lt;p&gt;There is an alternative to the vmsbackup tool that can run also on Windows
platforms as well. Refer to &lt;a href="http://labs.hoffmanlabs.com/node/817"&gt;hoffmanlabs&lt;/a&gt;
for further&amp;nbsp;information.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="go"&gt;VMSBackup Version 1.5 Jul 31 2013&lt;/span&gt;


&lt;span class="go"&gt;VMSBackup [FILE] [-L:listoption] [-N] [-X:extractmode] [-M:mask] [-F] [-V] [-D] [-?]&lt;/span&gt;


&lt;span class="go"&gt;FILE Backup Data Set &lt;/span&gt;
&lt;span class="go"&gt;-L Selects output list &lt;/span&gt;
&lt;span class="go"&gt;listoptions S Suppress Output B Brief Output (default) &lt;/span&gt;
&lt;span class="go"&gt;F Full Output C CSV Output &lt;/span&gt;
&lt;span class="go"&gt;-N Don&amp;#39;t Extract File Contents &lt;/span&gt;
&lt;span class="go"&gt;-X Selects Extraction Mode &lt;/span&gt;
&lt;span class="go"&gt;extractmode S Smart/Auto Mode (default) A ASCII Mode &lt;/span&gt;
&lt;span class="go"&gt;B Binary Mode R Raw Mode &lt;/span&gt;
&lt;span class="go"&gt;-M File Extraction Mask &lt;/span&gt;
&lt;span class="go"&gt;e.g. *.*, *.bin;*, *a*.*;-1 etc. &lt;/span&gt;
&lt;span class="go"&gt;Default is *.*;0. &lt;/span&gt;
&lt;span class="go"&gt;-F Extract with full path (default off) &lt;/span&gt;
&lt;span class="go"&gt;-V Extract with version numbers in the filename (default off) &lt;/span&gt;
&lt;span class="go"&gt;-D Debug Mode (default off) &lt;/span&gt;
&lt;span class="go"&gt;-DD Enhanced Debug Mode (default off) &lt;/span&gt;
&lt;span class="go"&gt;-? Display this help&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;5 - Restore the&amp;nbsp;system&lt;/h1&gt;
&lt;h2&gt;5.1 Restoring the system unit from a non-image&amp;nbsp;backup&lt;/h2&gt;
&lt;p&gt;The restoration process explained here will initialize the destination volume
and remove all current contents.
It is assumed that the system was boot from an emergency disk (or any other
method like bootable &lt;span class="caps"&gt;CD&lt;/span&gt;/&lt;span class="caps"&gt;DVD&lt;/span&gt;), &lt;span class="caps"&gt;SAN&lt;/span&gt; disks are reachable and applications that
may access the database or system files are&amp;nbsp;stopped.&lt;/p&gt;
&lt;p&gt;As explained before (Exclude files from being backed up), when a list of files
are excluded from the backup it is not possible to perform an image&amp;nbsp;backup.&lt;/p&gt;
&lt;p&gt;Image backup saves correctly the bootblock file (&lt;span class="caps"&gt;GPT&lt;/span&gt;.&lt;span class="caps"&gt;SYS&lt;/span&gt;) together with the
other files. However for file-based backups the boot block is lost (this
limitation has been fixed in newer versions of &lt;span class="caps"&gt;BACKUP&lt;/span&gt; for OpenVMS 8.4). In
consequence once a file-based backup is restored into a disk, system cannot
boot directly from it.
If using a non-empty value for &lt;code&gt;BACKUP_EXCLUDELIST&lt;/code&gt;, an additional step is
required for the restoration&amp;nbsp;process.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;If restoring from a full backup archive:&lt;/strong&gt;
- Destination volume must be initialized and&amp;nbsp;mounted:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;    :::factor
    # Alpha:
    SYSTEM&amp;gt; INITIALIZE /NOHIGH /CLUSTER=16 /EXTENSION=256 DSA0: AXPVMSSYS
    # Itanium:
    SYSTEM&amp;gt; INITIALIZE /NOHIGH /CLUSTER=64 /EXTENSION=256 DSA0: IA64VMSSYS

    SYSTEM&amp;gt; MOUNT /OVER=ID DSA0:
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Dump the backup contents to the destination volume as&amp;nbsp;follows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; BACKUP BCK_DSK:[BACKUP]SYSIMAGE.BCK /SAVE_SET /log dsa0:[000000...] /exclude=(gpt.sys,indexf.sys)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Estimated completion time can be shown while pressing Ctrl-T any time during&amp;nbsp;extraction.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;Saveset volume:1, saveset block:21736 (32256 byte blocks)
480.53MB decompressed out &lt;span class="nb"&gt;of &lt;/span&gt;26.68GB, 1% completed
Decompress rate: 4.76MB/sec, estimated completion time: 18:24:39.52
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;If restoring from an incremental backup&lt;/strong&gt;, a restore from a full backup must
be performed first, then the incremental backup(s) as&amp;nbsp;follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Dismount and remount the&amp;nbsp;volume:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; DISMOUNT DSA0:
SYSTEM&amp;gt; MOUNT /over=ID DSA0:
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Dump the incremental backups one by&amp;nbsp;one:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; BACKUP /INCREMENTAL BCK_DSK:[BACKUP]DELTA_18_JAN.SAV /SAVE_SET DSA0:
SYSTEM&amp;gt; BACKUP /INCREMENTAL BCK_DSK:[BACKUP]DELTA_25_JAN.SAV /SAVE_SET DSA0:
 [...]
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In order to &lt;strong&gt;restore the boot block&lt;/strong&gt;, run the following&amp;nbsp;command:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Alpha&amp;nbsp;systems&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; RUN SYS$SYSTEM:WRITEBOOT
Update VAX portion &lt;span class="nb"&gt;of &lt;/span&gt;boot block (default is Y): N
Update Alpha portion &lt;span class="nb"&gt;of &lt;/span&gt;boot block (default is Y): Y
Enter Alpha boot file: dsa0:[VMS$COMMON.SYSEXE]APB.EXE
Check &lt;span class="nb"&gt;if &lt;/span&gt;dsa0:[VMS$COMMON.SYSEXE]APB.EXE is contiguous by checking the &lt;span class="nb"&gt;map &lt;/span&gt;area as follows:
SYSTEM&amp;gt; DUMP/HEADER/BLOCK=END=0 dsa0:[VMS$COMMON.SYSEXE]APB.EXE
[...]
Map area 
 Retrieval pointers

        Count: &lt;span class="m"&gt;1152 &lt;/span&gt;LBN: &lt;span class="m"&gt;8254864&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If more than 1 retrieval pointer is shown, make the file contiguous as&amp;nbsp;follows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; COPY /CONTIGUOUS dsa0:[VMS$COMMON.SYSEXE]APB.EXE.0 dsa0:[VMS$COMMON.SYSEXE]APB.EXE
SYSTEM&amp;gt; SET FILE dsa0:[VMS$COMMON.SYSEXE]APB.EXE /NOMOVE
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Itanium&amp;nbsp;systems&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;This is usually not needed, since the &lt;code&gt;INITIALIZE&lt;/code&gt; command will properly
create the bootstrap on &lt;code&gt;GPT.SYS&lt;/code&gt; file (which has 2 extends, one starting
in sector 0 and the other in the last part of the unit; this may be checked
with the &lt;code&gt;DUMP /HEADER/BLOCK=END=0&lt;/code&gt; command).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; SET BOOTBLOCK /PRESERVE=SIGNATURE /I64 DSA0:
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Check consistency of the system disk&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;mc dfu verify DSA0: /directory_scan /lock /fix /rebuild
&lt;span class="nb"&gt;or&lt;/span&gt;
&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;analyze /disk_structure /repair
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Finally &lt;strong&gt;restore the &lt;span class="caps"&gt;EFI&lt;/span&gt; entries&lt;/strong&gt; as explained in 6.2/6.3&amp;nbsp;chapters.&lt;/p&gt;
&lt;h2&gt;5.2 Restoring the system unit from an image&amp;nbsp;backup&lt;/h2&gt;
&lt;p&gt;Restore full image to disk will initialize the destination volume and remove all
current contents.
It is assumed that the system was booted from an emergency disk (or any other
method like bootable &lt;span class="caps"&gt;CD&lt;/span&gt;/&lt;span class="caps"&gt;DVD&lt;/span&gt;), &lt;span class="caps"&gt;SAN&lt;/span&gt; disks are reachable processes accessing either
the database or system files are&amp;nbsp;stopped.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;If restoring from a full image&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Destination volume must be mounted&amp;nbsp;foreign:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; DISMOUNT /SYSTEM DSA0:
SYSTEM&amp;gt; MOUNT /FOREIGN DSA0:
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Dump the image contents to the destination volume as&amp;nbsp;follows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; BACKUP /IMAGE BCK_DSK:[BACKUP]SYSIMAGE.BCK /SAVE_SET /log dsa0:
Estimated completion time can be shown &lt;span class="nb"&gt;while &lt;/span&gt;pressing Ctrl-T any time during extraction.
Saveset volume:1, saveset block:21736 (32256 byte blocks)
480.53MB decompressed out &lt;span class="nb"&gt;of &lt;/span&gt;26.68GB, 1% completed
Decompress rate: 4.76MB/sec, estimated completion time: 18:24:39.52
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;If restoring from an incremental image&lt;/strong&gt;, a restore from a full image must be
performed first, then the incremental&amp;nbsp;backup(s):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Destination volume must be mounted&amp;nbsp;foreign:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; DISMOUNT DSA0:
SYSTEM&amp;gt; MOUNT /FOREIGN DSA0:
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Dump the image contents to the destination volume as&amp;nbsp;follows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; BACKUP /IMAGE BCK_DSK:[BACKUP]SYSIMAGE.BCK /SAVE_SET /log dsa0:
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Dismount and remount the&amp;nbsp;volume:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; DISMOUNT DSA0:
SYSTEM&amp;gt; MOUNT /over=ID DSA0:
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Dump the incremental backups one by&amp;nbsp;one:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; BACKUP /INCREMENTAL BCK_DSK:[BACKUP]DELTA_18_JAN.SAV /SAVE_SET DSA0:
SYSTEM&amp;gt; BACKUP /INCREMENTAL BCK_DSK:[BACKUP]DELTA_25_JAN.SAV /SAVE_SET DSA0:
 [...]
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Check consistency of the system disk&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;mc dfu verify DSA0: /directory_scan /lock /fix /rebuild
&lt;span class="nb"&gt;or&lt;/span&gt;
&lt;span class="nb"&gt;&amp;gt; &lt;/span&gt;analyze /disk_structure /repair
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Finally &lt;strong&gt;restore the &lt;span class="caps"&gt;EFI&lt;/span&gt; entries&lt;/strong&gt; as explained in 6.2/6.3&amp;nbsp;chapters.&lt;/p&gt;
&lt;h2&gt;5.3 Restoring the&amp;nbsp;Database&lt;/h2&gt;
&lt;h3&gt;5.3.1. Stop attached&amp;nbsp;processes&lt;/h3&gt;
&lt;p&gt;In order to restore the Database (&lt;span class="caps"&gt;SDB&lt;/span&gt;), it is needed that no users are attached
to it.
To check if there is any other process attached to the &lt;span class="caps"&gt;SDB&lt;/span&gt;, run the following&amp;nbsp;commands:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Oracle:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; RMU/DUMP/USER db_sdb (should report: &lt;span class="s"&gt;&amp;quot;NO ACTIVE USERS&amp;quot;&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Mimer:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; mc sysman &lt;span class="nb"&gt;set &lt;/span&gt;environment /cluster
SYSMAN&amp;gt; DO MIMCONTROL /STATUS
%SYSMAN-I-OUTPUT, command execution &lt;span class="nb"&gt;on &lt;/span&gt;node SYSTEM_1
The server for database DB_SDB is Running
New logins are Enabled
Directory for SYSDB is SYSTEM_DB:[DB_SDB]
Number &lt;span class="nb"&gt;of &lt;/span&gt;connections to server: &lt;span class="m"&gt;2&lt;/span&gt;
[...]
SYSMAN&amp;gt; DO MIMCONTROL /STOP DB_SDB
SYSMAN&amp;gt; exit
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;5.3.2. Restore &lt;span class="caps"&gt;SDB&lt;/span&gt; from a&amp;nbsp;backup&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Oracle:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; RMU /RESTORE /NOCDD /LOG /NEW_VERSION &lt;span class="nb"&gt;-&lt;/span&gt;
_SYSTEM&amp;gt; /DIR=DATABASE_DISK:[DATA] database_backup.rbf
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Mimer:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; @sbr$root:[scripts]RCV_MIMER_RDB database_backup.bck
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;At this stage, services that make use of the database may be started&amp;nbsp;back.&lt;/p&gt;
&lt;h1&gt;6 -&amp;nbsp;Troubleshooting&lt;/h1&gt;
&lt;h2&gt;6.1 Emergency disk&amp;nbsp;initialization&lt;/h2&gt;
&lt;p&gt;This method installs a minimum OpenVMS Environment (install with no options) on
a disk from which backup and restore operations can be performed for the system
unit. The minimum OpenVMS Environment is created in the &lt;code&gt;[SYSE]&lt;/code&gt; root on the
disk, which runs a subset of OpenVMS and is indicated by the triple dollar sign
(&lt;code&gt;$$$&lt;/code&gt;) system prompt.
For the examples below, assume that disk &lt;code&gt;DKA200:&lt;/code&gt; will be initialized with
minimum OpenVMS Environment (&lt;em&gt;emergency boot&lt;/em&gt;&amp;nbsp;disk).&lt;/p&gt;
&lt;p&gt;The target disk must be mounted privately to your process (this prevents other
users from accessing this disk during the installation and backup procedures).
Therefore, if the target disk was mounted with the &lt;code&gt;/SYSTEM&lt;/code&gt;, &lt;code&gt;/CLUSTER&lt;/code&gt;,
&lt;code&gt;/GROUP&lt;/code&gt;, or &lt;code&gt;/SHARE&lt;/code&gt; qualifier, dismount that disk and mount it without those
qualifiers or the &lt;code&gt;/FOREIGN&lt;/code&gt; qualifier. For&amp;nbsp;example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; INITIALIZE /NOHIGH/cluster=64/extension=256/header=8000 DKA200: BCK_DSK
SYSTEM&amp;gt; MOUNT/OVERRIDE=IDENTIFICATION DKA200:
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;For OpenVMS I64, enter the following command (answer &lt;strong&gt;&lt;em&gt;&lt;span class="caps"&gt;YES&lt;/span&gt;&lt;/em&gt;&lt;/strong&gt; when asked to
create the boot&amp;nbsp;option):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; @SYS$SYSTEM:I64VMS$PCSI_INSTALL_MIN.COM DKA200:
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;For OpenVMS Alpha, enter the following&amp;nbsp;command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; @SYS$SYSTEM:AXPVMS$PCSI_INSTALL_MIN.COM DKA200:
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Refer to 1.1 for more information about the output of these&amp;nbsp;commands.&lt;/p&gt;
&lt;p&gt;Finally, copy the &lt;span class="caps"&gt;ZIP&lt;/span&gt; and &lt;span class="caps"&gt;UNZIP&lt;/span&gt; binaries to the emergency&amp;nbsp;disk.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;u&gt;Note&lt;/u&gt;:&lt;/strong&gt;: doublecheck that the versions of &lt;span class="caps"&gt;ZIP&lt;/span&gt; and &lt;span class="caps"&gt;UNZIP&lt;/span&gt; are supported
as explained in&amp;nbsp;1.3.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;6.2 Restoring &lt;span class="caps"&gt;EFI&lt;/span&gt; entries&amp;nbsp;(Itanium)&lt;/h1&gt;
&lt;p&gt;Once a system unit has been restored from a backup, &lt;span class="caps"&gt;EFI&lt;/span&gt; entries may not be
correct and need to be fixed. Otherwise, automatic boot process will fail since
the default entry has an incorrect value. In order to fix this, the following
process must be&amp;nbsp;followed:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; @SYS$MANAGER:BOOT_OPTIONS


 OpenVMS I64 Boot Manager Boot Options List Management Utility


 (1) ADD an entry to the Boot Options list 
 (2) DISPLAY the Boot Options list 
 (3) REMOVE an entry from the Boot Options list 
 (4) MOVE the position &lt;span class="nb"&gt;of &lt;/span&gt;an entry in the Boot Options list 
 (5) VALIDATE boot options &lt;span class="nb"&gt;and &lt;/span&gt;fix them as necessary 
 (6) Modify Boot Options TIMEOUT setting




 (B) Set to operate &lt;span class="nb"&gt;on &lt;/span&gt;the Boot Device Options list 
 (D) Set to operate &lt;span class="nb"&gt;on &lt;/span&gt;the Dump Device Options list 
 (G) Set to operate &lt;span class="nb"&gt;on &lt;/span&gt;the Debug Device Options list


 (E) EXIT from Boot Manager utility


 You can also enter Ctrl-Y &lt;span class="nb"&gt;at &lt;/span&gt;any time to abort this utility.


Enter your choice: &lt;span class="m"&gt;5&lt;/span&gt;


To validate all entries in the Boot Options list, press Return. 
To validate specific entries, enter the entry &lt;span class="nb"&gt;number or &lt;/span&gt;device name. 
(Enter &lt;span class="s"&gt;&amp;quot;?&amp;quot;&lt;/span&gt; to display Boot Options list): &amp;lt;RETURN&amp;gt;
Do you really want to validate all list entries? (Yes/No) Yes


Enter your choice: E
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;6.3 Restoring boot entries&amp;nbsp;(Alpha)&lt;/h2&gt;
&lt;p&gt;On Alpha platforms, once the system unit has been restored from a backup, boot
entries may not be correct and need to be fixed. The following lines show an
example of restoring the default boot entries on an Alpha system from the
&lt;em&gt;chevron&lt;/em&gt; prompt (&lt;code&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/code&gt;).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="go"&gt;P00&amp;gt;&amp;gt;&amp;gt; init&lt;/span&gt;
&lt;span class="go"&gt;Initializing...&lt;/span&gt;
&lt;span class="go"&gt; [...]&lt;/span&gt;
&lt;span class="go"&gt;P00&amp;gt;&amp;gt;&amp;gt; show device&lt;/span&gt;
&lt;span class="go"&gt;dga100.1001.0.8.1 $1$DGA100 HSG80 V87F Fibre disks &lt;/span&gt;
&lt;span class="go"&gt;dga104.1001.0.8.1 $1$DGA104 HSG80 V87F &lt;/span&gt;
&lt;span class="go"&gt;dgb100.1003.0.8.0 $1$DGA100 HSG80 V87F &lt;/span&gt;
&lt;span class="go"&gt;dgb104.1003.0.8.0 $1$DGA104 HSG80 V87F &lt;/span&gt;
&lt;span class="go"&gt;dkb400.4.0.106.0 DKB400 COMPAQ BD009635CB BDC4 SAS disks &lt;/span&gt;
&lt;span class="go"&gt;dkb500.5.0.106.0 DKB500 COMPAQ BD009635CB BDC4 &lt;/span&gt;
&lt;span class="go"&gt;dqa0.0.0.105.0 DQA0 CD-224E 9.5B 3.5&amp;#39;&amp;#39; drive &lt;/span&gt;
&lt;span class="go"&gt;dva0.0.0.0.0 DVA0 CD/DVD drive &lt;/span&gt;
&lt;span class="go"&gt;eia0.0.0.2005.1 EIA0 00-06-2B-00-C7-E6 Ethernet devices &lt;/span&gt;
&lt;span class="go"&gt;eib0.0.0.3004.1 EIB0 00-08-02-61-91-62  &lt;/span&gt;
&lt;span class="go"&gt;eic0.0.0.3005.1 EIC0 00-08-02-61-91-63 &lt;/span&gt;
&lt;span class="go"&gt;eid0.0.0.2004.0 EID0 00-08-02-61-91-80 &lt;/span&gt;
&lt;span class="go"&gt;eie0.0.0.2005.0 EIE0 00-08-02-61-91-81 &lt;/span&gt;
&lt;span class="go"&gt;pga0.0.0.8.1 PGA0 WWN 1000-0000-c92c-c5f1 Fibre channels &lt;/span&gt;
&lt;span class="go"&gt;pgb0.0.0.8.0 PGB0 WWN 1000-0000-c92c-d63d &lt;/span&gt;
&lt;span class="go"&gt;pka0.7.0.6.0 PKA0 SCSI Bus ID 7 SCSI channels &lt;/span&gt;
&lt;span class="go"&gt;pkb0.7.0.106.0 PKB0 SCSI Bus ID 7&lt;/span&gt;

&lt;span class="go"&gt;P00&amp;gt;&amp;gt;&amp;gt; wwidmgr -clear all&lt;/span&gt;
&lt;span class="go"&gt;P00&amp;gt;&amp;gt;&amp;gt; wwidmgr -quickset -udid 100&lt;/span&gt;

&lt;span class="go"&gt;Disk assignment and reachability after next initialization:&lt;/span&gt;

&lt;span class="go"&gt;6000-1fe1-001b-bee0-0009-2310-0258-0047&lt;/span&gt;
&lt;span class="go"&gt;via adapter: via fc nport: connected: &lt;/span&gt;
&lt;span class="go"&gt;dga100.1001.0.8.1 pga0.0.0.8.1 5000-1fe1-001b-bee1 No &lt;/span&gt;
&lt;span class="go"&gt;dga100.1002.0.8.1 pga0.0.0.8.1 5000-1fe1-001b-bee4 Yes&lt;/span&gt;
&lt;span class="go"&gt;dgb100.1003.0.8.0 pgb0.0.0.8.0 5000-1fe1-001b-bee2 No &lt;/span&gt;
&lt;span class="go"&gt;dgb100.1004.0.8.0 pgb0.0.0.8.0 5000-1fe1-001b-bee3 Yes&lt;/span&gt;

&lt;span class="go"&gt;P00&amp;gt;&amp;gt;&amp;gt; wwidmgr -quickset -udid 104&lt;/span&gt;

&lt;span class="go"&gt;Disk assignment and reachability after next initialization:&lt;/span&gt;

&lt;span class="go"&gt;6000-1fe1-001b-bee0-0009-2300-0170-001f&lt;/span&gt;
&lt;span class="go"&gt;via adapter: via fc nport: connected: &lt;/span&gt;
&lt;span class="go"&gt;dga104.1001.0.8.1 pga0.0.0.8.1 5000-1fe1-001b-bee1 No &lt;/span&gt;
&lt;span class="go"&gt;dga104.1002.0.8.1 pga0.0.0.8.1 5000-1fe1-001b-bee4 Yes&lt;/span&gt;
&lt;span class="go"&gt;dgb104.1003.0.8.0 pgb0.0.0.8.0 5000-1fe1-001b-bee2 No &lt;/span&gt;
&lt;span class="go"&gt;dgb104.1004.0.8.0 pgb0.0.0.8.0 5000-1fe1-001b-bee3 Yes&lt;/span&gt;

&lt;span class="go"&gt;P00&amp;gt;&amp;gt;&amp;gt; set mode diag&lt;/span&gt;
&lt;span class="go"&gt;P00&amp;gt;&amp;gt;&amp;gt; init&lt;/span&gt;
&lt;span class="go"&gt;P00&amp;gt;&amp;gt;&amp;gt; show device&lt;/span&gt;
&lt;span class="go"&gt;[...output omitted...]&lt;/span&gt;

&lt;span class="go"&gt;P00&amp;gt;&amp;gt;&amp;gt; show bootdef_dev&lt;/span&gt;
&lt;span class="go"&gt;bootdef_dev dga100.1002.0.8.1&lt;/span&gt;

&lt;span class="go"&gt;P00&amp;gt;&amp;gt;&amp;gt; set bootdef_dev dga100.1002.0.8.1, dgb100.1004.0.8.0, dga100.1001.0.8.1, dgb100.1003.0.8.0, dga104.1002.0.8.1, dgb104.1004.0.8.0, dga104.1001.0.8.1, dgb104.1003.0.8.0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The system will follow this order (boot from 1st bootstrap&amp;nbsp;available).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="go"&gt;P00&amp;gt;&amp;gt;&amp;gt; boot&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;6.4 Add an &lt;span class="caps"&gt;EFI&lt;/span&gt; entry for the emergency disk&amp;nbsp;(Itanium)&lt;/h2&gt;
&lt;p&gt;When present, the &lt;code&gt;EFI&lt;/code&gt; entry for booting from an emergency disk may be useful
for the&amp;nbsp;operator.&lt;/p&gt;
&lt;p&gt;Using the same menu-driven application as explained above, add an entry for an
emergency disk (i.e. &lt;code&gt;DKA200:&lt;/code&gt;) installed in the current node. This unit must be
mounted before running the script.
Choose option (1) from the menu, then check with option&amp;nbsp;(2).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; @SYS$MANAGER:BOOT_OPTIONS


 OpenVMS I64 Boot Manager Boot Options List Management Utility


 (1) ADD an entry to the Boot Options list 
 (2) DISPLAY the Boot Options list 
 (3) REMOVE an entry from the Boot Options list 
 (4) MOVE the position &lt;span class="nb"&gt;of &lt;/span&gt;an entry in the Boot Options list 
 (5) VALIDATE boot options &lt;span class="nb"&gt;and &lt;/span&gt;fix them as necessary 
 (6) Modify Boot Options TIMEOUT setting


 (B) Set to operate &lt;span class="nb"&gt;on &lt;/span&gt;the Boot Device Options list 
 (D) Set to operate &lt;span class="nb"&gt;on &lt;/span&gt;the Dump Device Options list 
 (G) Set to operate &lt;span class="nb"&gt;on &lt;/span&gt;the Debug Device Options list


 (E) EXIT from Boot Manager utility


 You can also enter Ctrl-Y &lt;span class="nb"&gt;at &lt;/span&gt;any time to abort this utility.


Enter your choice: &lt;span class="m"&gt;1&lt;/span&gt;
Enter the device name (Enter &lt;span class="s"&gt;&amp;quot;?&amp;quot;&lt;/span&gt; for a list &lt;span class="nb"&gt;of &lt;/span&gt;devices): $1$DKA200: 
Would you &lt;span class="nb"&gt;like &lt;/span&gt;to mount $1$DKA200: &lt;span class="nb"&gt;? &lt;/span&gt;(Yes/No) [YES] 
Enter the desired position &lt;span class="nb"&gt;number &lt;/span&gt;(1,2,3,,,) &lt;span class="nb"&gt;of &lt;/span&gt;the entry. 
To display the Boot Options list, enter &lt;span class="s"&gt;&amp;quot;?&amp;quot;&lt;/span&gt; &lt;span class="nb"&gt;and &lt;/span&gt;press Return. 
Position [1]: &lt;span class="m"&gt;3&lt;/span&gt;


Enter the value for VMS_FLAGS in the form n,n. 
VMS_FLAGS [NONE]: e,0 
Enter a &lt;span class="nb"&gt;short &lt;/span&gt;description (do &lt;span class="nb"&gt;not &lt;/span&gt;include quotation marks). 
Description [&amp;quot;$1$DKA200:&amp;quot;]: EMERGENCY
efi$bcfg: $1$dka200: (Boot0005) Option successfully added


Enter your choice: &lt;span class="m"&gt;2&lt;/span&gt;


To display all entries in the Boot Options list, press Return. 
To display specific entries, enter the entry &lt;span class="nb"&gt;number or &lt;/span&gt;device name. 
(Enter &lt;span class="s"&gt;&amp;quot;?&amp;quot;&lt;/span&gt; for a list &lt;span class="nb"&gt;of &lt;/span&gt;devices): &amp;lt;RETURN&amp;gt;


EFI Boot Options list: Timeout &lt;span class="nb"&gt;= &lt;/span&gt;&lt;span class="m"&gt;10 &lt;/span&gt;secs.


Entry Description Options 
----- ---------------------------------------------------------- ------------- 
 &lt;span class="m"&gt;1 &lt;/span&gt;OpenVMS IA64 PKC0.5000-C500-2396-AD49 -fl &lt;span class="m"&gt;0,0 &lt;/span&gt;
 $3$DGA10 PCI(0|7|0|0) Sas(5000C5002396AD49,Lun0) 
 &lt;span class="m"&gt;2 &lt;/span&gt;EFI Shell [Built-in] 
 VenHw(d65a6b8c-71e5-4df0-d2f009a9) 
 &lt;span class="m"&gt;3 &lt;/span&gt;EMERGENCY PKA0.5000-C500-240F-5681 -fl e,0 
 $1$DKA200 PCI(0|1|1|0) Sas(5000C500240F5681,Lun0) 
 &lt;span class="m"&gt;4 &lt;/span&gt;Internal Bootable DVD -fl &lt;span class="m"&gt;0,0 &lt;/span&gt;
 $1$DNA0 PCI(0|0|2|2) Usb(1,0) 
-------------------------------------------------------------------------------- 
&lt;span class="m"&gt;5 &lt;/span&gt;entries found.
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;6.5 Manually booting from an emergency&amp;nbsp;disk&lt;/h2&gt;
&lt;p&gt;Use the emergency system disk (on which the minimum OpenVMS environment was
installed) to perform backup and restore operations as&amp;nbsp;follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Alpha&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Halt the node, then from the chevron&amp;nbsp;prompt:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; BOOT -FLAGS E,0 DKA200
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;span class="caps"&gt;IA64&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Reboot the node, then enter to the &lt;span class="caps"&gt;EFI&lt;/span&gt; shell once the boot entries menu is&amp;nbsp;displayed.&lt;/p&gt;
&lt;p&gt;Identify which is the emergency disk from the detected devices, then run the
vms loader with flags &lt;code&gt;e,0&lt;/code&gt; (emergency root, no&amp;nbsp;cluster).&lt;/p&gt;
&lt;p&gt;Local disks are tagged as &lt;span class="caps"&gt;SAS&lt;/span&gt; (Serial Attached &lt;span class="caps"&gt;SCSI&lt;/span&gt;) while units mounted
from a disk controller appear as Fibre or &lt;span class="caps"&gt;SCSI&lt;/span&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="go"&gt;Shell&amp;gt; reconnect -r&lt;/span&gt;
&lt;span class="go"&gt;Shell&amp;gt; map -r -fs&lt;/span&gt;
&lt;span class="go"&gt;Shell&amp;gt; vms_show device -fs&lt;/span&gt;
&lt;span class="go"&gt;VMS: DKA0 COMPAQ BF1468B26B HPB9 V8_3 &lt;/span&gt;
&lt;span class="go"&gt;EFI: fs0: Acpi(HWP0002,300,PNP0A03)/Pci(1|0)/Scsi(Pun0,Lun0)fs&lt;/span&gt;
&lt;span class="go"&gt;VMS: DKC-1 HP DG072BB975 HPDC V8_3 &lt;/span&gt;
&lt;span class="go"&gt;EFI: fs2: Acpi(HWP0002,400,PNP0A03)/Pci(1|0)/Sas(Addr5000C5000B9E4625)&lt;/span&gt;
&lt;span class="go"&gt;VMS: DKD0 COMPAQ BF1468B26B HPB9 V8_3 &lt;/span&gt;
&lt;span class="go"&gt;EFI: fs4: Acpi(HWP0002,700,PNP0A03)/Pci(1|0)/Scsi(Pun0,Lun0)&lt;/span&gt;
&lt;span class="go"&gt; Shell&amp;gt; fs2:\efi\vms\vms_loader.efi -flags e,0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Refer to “OpenVMS upgrade and installation Manual, Appendix B.3: Overview of
Using &lt;span class="caps"&gt;EFI&lt;/span&gt;” for more information on how to access the &lt;span class="caps"&gt;EFI&lt;/span&gt;&amp;nbsp;shell.&lt;/p&gt;
&lt;h2&gt;6.6 Backup archive&amp;nbsp;attributes&lt;/h2&gt;
&lt;p&gt;During backup archive transference, file attributes may be modified, especially
when working with different Operative Systems (like push the backup to a &lt;span class="caps"&gt;UNIX&lt;/span&gt;&amp;nbsp;server).&lt;/p&gt;
&lt;p&gt;When &lt;span class="caps"&gt;FTP&lt;/span&gt; is used for the transference, backup and recovery of the attributes can
be achieved when setting &lt;code&gt;/FDL&lt;/code&gt; qualifier in OpenVMS&amp;nbsp;client.&lt;/p&gt;
&lt;p&gt;For &lt;span class="caps"&gt;SFTP&lt;/span&gt;, it is suggested to either archive the &lt;code&gt;.BCK&lt;/code&gt; file into a &lt;span class="caps"&gt;ZIP&lt;/span&gt; file with
&amp;ldquo;-V&amp;rdquo; flag set or use the &lt;span class="caps"&gt;FDL&lt;/span&gt; (File Definition Language) file to manually restore
the original &lt;span class="caps"&gt;RMS&lt;/span&gt; properties of the backup archive. For the former, the &lt;span class="caps"&gt;RMS&lt;/span&gt; file
attributes are stored in the zipped archive, and can be retained while deflating
with unzip &amp;ldquo;-V&amp;rdquo;, thus &lt;span class="caps"&gt;FDL&lt;/span&gt; file is not&amp;nbsp;needed.&lt;/p&gt;
&lt;p&gt;Manual restoration may also be needed when not working with the script (i.e.
transferring the file&amp;nbsp;manually).&lt;/p&gt;
&lt;p&gt;For restoring file attributes of the backup images&amp;nbsp;do:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; CONVERT /FDL=backup_archive.fdl transferred_backup.bck recovered_backup.bck
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If the backup file is damaged, there are some other ways to recover its&amp;nbsp;contents: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; BACKUP /list /save_set /repair backup_archive.bck
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Else&amp;nbsp;try:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; @RESET_BACKUP_SAVESET_ATTRIBUTES.COM backup_archive.bck
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;Refer to Appendix B for &lt;code&gt;RESET_BACKUP_SAVESET_ATTRIBUTES.COM&lt;/code&gt; content.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In various cases the following commands might&amp;nbsp;work:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; SET FILE/ATTRIBUTES=(RFM:FIX,MRS:32256,LRL:32256,RAT:NONE) SYSIMAGE.BCK
SYSTEM&amp;gt; SET FILE/ATTRIBUTES=(DEQ:0,RFM:VAR,MRS:32256,LRL:32256,RAT:NONE) SYSIMAGE.BCK
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;For restoring file attributes of &lt;span class="caps"&gt;RDB&lt;/span&gt; backup&amp;nbsp;do:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;SYSTEM&amp;gt; SET FILE/ATTRIB=(DEQ:2048,RFM:FIX,MRS:32256,RAT:NONE) *.rbf
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Refer to the “Guide to OpenVMS File Applications” for more information about
&lt;span class="caps"&gt;FDL&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Besides this, the &lt;span class="caps"&gt;ZIP&lt;/span&gt; archive contains the backup operation command that was
executed in the system as a&amp;nbsp;comment.&lt;/p&gt;
&lt;p&gt;The archive comment can be displayed with &lt;code&gt;unzip -z&lt;/code&gt;.&lt;/p&gt;
&lt;h1&gt;Appendix A - Script&amp;nbsp;workflow&lt;/h1&gt;
&lt;p&gt;&lt;a href="https://github.com/fernandezcuesta/smsctools/raw/master/Diagram.dia"&gt;&lt;img alt="Diagram" src="images/diagram_bck.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;Appendix B - Reset backup saveset attributes&amp;nbsp;script&lt;/h1&gt;
&lt;p&gt;&lt;span class="caps"&gt;DCL&lt;/span&gt; script useful for resetting saveset file&amp;nbsp;attributes.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;$! RESET_BACKUP_SAVESET_ATTRIBUTES.COM
$!
$! P1  is the specification &lt;span class="nb"&gt;of &lt;/span&gt;the BACKUP saveset
$!
$! This procedure resets the record format &lt;span class="nb"&gt;and &lt;/span&gt;record
$! &lt;span class="nb"&gt;length &lt;/span&gt;attributes &lt;span class="nb"&gt;of &lt;/span&gt;a BACKUP saveset -- savesets 
$! can &lt;span class="nb"&gt;get &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;broken&amp;quot;&lt;/span&gt; during certain sorts &lt;span class="nb"&gt;of &lt;/span&gt;file
$! transfers -- such as FTP.  This procedure reads the
$! (undocumented) saveset record attributes directly
$! out &lt;span class="nb"&gt;of &lt;/span&gt;the target file.
$!
$! First render the saveset readable, &lt;span class="nb"&gt;and &lt;/span&gt;implicitly
$! check that the file exists.
$!
&lt;span class="no"&gt;$ Set&lt;/span&gt; File &lt;span class="nb"&gt;-&lt;/span&gt;
    /Attributes=(RFM:FIX,MRS:512,LRL=512,ORG=SEQ,RAT=NONE) &lt;span class="nb"&gt;-&lt;/span&gt;
    &amp;#39;p1&amp;#39;
&lt;span class="no"&gt;$&lt;/span&gt;
&lt;span class="no"&gt;$&lt;/span&gt; Open/Error=whoops/Read BckSaveset &amp;#39;p1&amp;#39;
&lt;span class="no"&gt;$ Read/Error=whoops/End=whoops&lt;/span&gt; BckSaveset Record
&lt;span class="no"&gt;$ Close/Nolog&lt;/span&gt; BckSaveset
&lt;span class="no"&gt;$&lt;/span&gt;
&lt;span class="no"&gt;$!&lt;/span&gt; Find the blocksize from within the record...
&lt;span class="no"&gt;$&lt;/span&gt;
&lt;span class="no"&gt;$&lt;/span&gt; BlockSize &lt;span class="nb"&gt;= &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="no"&gt;$ BBH_L_BLOCKSIZE&lt;/span&gt; &lt;span class="nb"&gt;= &lt;/span&gt;%x28*8
&lt;span class="no"&gt;$ BlockSize&lt;/span&gt; &lt;span class="nb"&gt;= &lt;/span&gt;F$CVUI(BBH_L_BLOCKSIZE, 32, Record)
&lt;span class="no"&gt;$ If&lt;/span&gt; BlockSize .lt. &lt;span class="m"&gt;2048 &lt;/span&gt;.or. BlockSize .gt. &lt;span class="m"&gt;65535&lt;/span&gt;
&lt;span class="no"&gt;$ Then&lt;/span&gt;
&lt;span class="no"&gt;$   Write&lt;/span&gt; sys$output &lt;span class="s"&gt;&amp;quot;Unexpected block size&amp;quot;&lt;/span&gt;
&lt;span class="no"&gt;$   Goto&lt;/span&gt; whoops
&lt;span class="no"&gt;$ Else&lt;/span&gt;
&lt;span class="no"&gt;$   Set&lt;/span&gt; File /Attributes=(RFM:FIX,LRL=&amp;#39;BlockSize&amp;#39;, &lt;span class="nb"&gt;-&lt;/span&gt;
       MRS=&amp;#39;BlockSize&amp;#39;,RAT=none) &lt;span class="nb"&gt;-&lt;/span&gt;
       &amp;#39;p1&amp;#39;
&lt;span class="no"&gt;$ endif&lt;/span&gt;
&lt;span class="no"&gt;$ exit&lt;/span&gt;
$WHOOPS:
&lt;span class="no"&gt;$ Write&lt;/span&gt; sys$output &lt;span class="s"&gt;&amp;quot;Error&amp;quot;&lt;/span&gt;
&lt;span class="no"&gt;$ exit&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Appendix C - Script configuration&amp;nbsp;file&lt;/h1&gt;
&lt;p&gt;Script configuration file&amp;nbsp;example.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;[SYS_BACKUP_CFG]&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: BACKUP_DIRECTORY. Format: Directory.&lt;/span&gt;
&lt;span class="na"&gt;BACKUP_LOCATION&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;bck_dsk:[backup]&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: BACKUP_EXCLUDELIST. Format: Filespec (Comma sep.)&lt;/span&gt;
&lt;span class="c1"&gt;# Directories must be specified as [DIRECTORY.NAME...]*&lt;/span&gt;
&lt;span class="c1"&gt;# If BACKUP_EXCLUDELIST is empty, Image backup will be performed&lt;/span&gt;
&lt;span class="na"&gt;BACKUP_EXCLUDELIST&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;*.LOG,[GOLD.KITS...]*,*.PCSI*,*.ZIPEXE&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: BACKUP_TIME&lt;/span&gt;
&lt;span class="c1"&gt;# Format: &amp;quot;hh:mm&amp;quot; time for the reschedule&lt;/span&gt;
&lt;span class="na"&gt;BACKUP_TIME&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;02:00&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: BACKUP_WDAY - day of the week for full backup&lt;/span&gt;
&lt;span class="c1"&gt;# Format: {Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday}&lt;/span&gt;
&lt;span class="na"&gt;BACKUP_WDAY&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Monday&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: INCREMENTAL (Yes,[No])&lt;/span&gt;
&lt;span class="c1"&gt;# Incremental backups are done daily,&lt;/span&gt;
&lt;span class="c1"&gt;# otherwise weekly at Backup_wday:Backup_time&lt;/span&gt;
&lt;span class="na"&gt;INCREMENTAL&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;NO&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: RESCHEDULE (Yes,[No])&lt;/span&gt;
&lt;span class="na"&gt;RESCHEDULE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;YES&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: SDB_FORCE (Yes,[No])&lt;/span&gt;
&lt;span class="na"&gt;SDB_FORCE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;YES&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Database name: SDB_NAME&lt;/span&gt;
&lt;span class="c1"&gt;#SDB_NAME = &amp;quot;&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: SDB_KEEPDAYS-&amp;gt; SDB backups local store days ([30])&lt;/span&gt;
&lt;span class="na"&gt;SDB_KEEPDAYS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;30&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: BACKUP_DAYS_KEEP_LOCAL_ARCHIVE&lt;/span&gt;
&lt;span class="c1"&gt;# Format: Integer&lt;/span&gt;
&lt;span class="na"&gt;BACKUP_DAYS_KEEP_LOCAL_ARCHIVE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;30&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: ZIP_ARCHIVE (&amp;quot;Always&amp;quot;,[&amp;quot;Skip&amp;quot;])&lt;/span&gt;
&lt;span class="na"&gt;ZIP_ARCHIVE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;SKIP&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# Configuration item: BACKUP_LOG_DIR&lt;/span&gt;
&lt;span class="na"&gt;BACKUP_LOG_DIR&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;bck_dsk:[BACKUP.LOG]&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: FILE_TRANSFER {FTP, SFTP, PULL=None}&lt;/span&gt;
&lt;span class="c1"&gt;# SFTP assumes Public-key authentication&lt;/span&gt;
&lt;span class="c1"&gt;# Pull does not transfer the archive, just puts it into a ZIP file&lt;/span&gt;
&lt;span class="na"&gt;FILE_TRANSFER&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;SFTP&amp;quot;&lt;/span&gt;

&lt;span class="k"&gt;[SYS_BACKUP_TX]&lt;/span&gt;
&lt;span class="c1"&gt;# Transference settings (for FILE_TRANSFER values rather than PULL)&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# Configuration item: BACKUP_REMOTE_DIRECTORY. Format: Directory&lt;/span&gt;
&lt;span class="c1"&gt;# Use &amp;quot;.&amp;quot; for current or default directory&lt;/span&gt;
&lt;span class="na"&gt;BACKUP_REMOTE_DIRECTORY&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;.&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: BACKUP_REM_NODE&lt;/span&gt;
&lt;span class="c1"&gt;# Format: IP address (&amp;quot;n.n.n.n&amp;quot;) or hostname&lt;/span&gt;
&lt;span class="na"&gt;BACKUP_REM_NODE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ftp_san&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: BACKUP_REM_USER&lt;/span&gt;
&lt;span class="c1"&gt;# Format: &amp;quot;username password&amp;quot;, or &amp;quot;user&amp;quot; for public-key authentication&lt;/span&gt;
&lt;span class="na"&gt;BACKUP_REM_USER&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;bkpusr&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: BACKUP_REMOTE_SYSTEM_TYPE&lt;/span&gt;
&lt;span class="c1"&gt;# Remote OS system {UNIX, VMS}&lt;/span&gt;
&lt;span class="na"&gt;BACKUP_REMOTE_SYSTEM_TYPE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;UNIX&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: FILE_COUNT_FOR_TRANSFER&lt;/span&gt;
&lt;span class="c1"&gt;# Number of attempts to tranfer the file&lt;/span&gt;
&lt;span class="na"&gt;FILE_COUNT_FOR_TRANSFER&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;3&lt;/span&gt;

&lt;span class="c1"&gt;# Configuration item: REMOTE_SFTP_COMMAND&lt;/span&gt;
&lt;span class="c1"&gt;# For SFTP, set up a command to be executed once the transfer is done&lt;/span&gt;
&lt;span class="na"&gt;REMOTE_SFTP_COMMAND&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;sh cleanup.sh&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="OpenVMS"></category></entry><entry><title>Playing with pandas</title><link href="http://fernandezcuesta.github.io/playing-with-pandas.html" rel="alternate"></link><updated>2014-11-20T00:00:00+01:00</updated><author><name>J.M. Fernández</name></author><id>tag:fernandezcuesta.github.io,2014-11-20:playing-with-pandas.html</id><summary type="html">&lt;h2&gt;Select all (but one) columns of a&amp;nbsp;dataframe&lt;/h2&gt;
&lt;p&gt;A fast and easy way to select all columns rather than those included in a&amp;nbsp;list:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;randn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;C&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;D&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

          &lt;span class="n"&gt;A&lt;/span&gt;         &lt;span class="n"&gt;B&lt;/span&gt;         &lt;span class="n"&gt;C&lt;/span&gt;         &lt;span class="n"&gt;D&lt;/span&gt;
&lt;span class="mi"&gt;0&lt;/span&gt;  &lt;span class="mf"&gt;0.630446&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;1.454207&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.021687&lt;/span&gt;  &lt;span class="mf"&gt;1.095301&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt;  &lt;span class="mf"&gt;0.374037&lt;/span&gt;  &lt;span class="mf"&gt;1.301607&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;1.316152&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.272031&lt;/span&gt;
&lt;span class="mi"&gt;2&lt;/span&gt;  &lt;span class="mf"&gt;1.102625&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;1.109953&lt;/span&gt;  &lt;span class="mf"&gt;1.058960&lt;/span&gt;  &lt;span class="mf"&gt;0.725778&lt;/span&gt;
&lt;span class="mi"&gt;3&lt;/span&gt;  &lt;span class="mf"&gt;0.619485&lt;/span&gt;  &lt;span class="mf"&gt;1.500641&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.370432&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.356188&lt;/span&gt;
&lt;span class="mi"&gt;4&lt;/span&gt;  &lt;span class="mf"&gt;0.323979&lt;/span&gt;  &lt;span class="mf"&gt;0.008434&lt;/span&gt;  &lt;span class="mf"&gt;0.616835&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.632381&lt;/span&gt;
&lt;span class="mi"&gt;5&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.721451&lt;/span&gt;  &lt;span class="mf"&gt;0.852577&lt;/span&gt;  &lt;span class="mf"&gt;1.071660&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.087884&lt;/span&gt;
&lt;span class="mi"&gt;6&lt;/span&gt;  &lt;span class="mf"&gt;0.440051&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.340789&lt;/span&gt;  &lt;span class="mf"&gt;0.602363&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.442707&lt;/span&gt;
&lt;span class="mi"&gt;7&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.890141&lt;/span&gt;  &lt;span class="mf"&gt;1.062083&lt;/span&gt;  &lt;span class="mf"&gt;0.959767&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.627261&lt;/span&gt;

&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;C&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;

          &lt;span class="n"&gt;A&lt;/span&gt;         &lt;span class="n"&gt;D&lt;/span&gt;
&lt;span class="mi"&gt;0&lt;/span&gt;  &lt;span class="mf"&gt;0.630446&lt;/span&gt;  &lt;span class="mf"&gt;1.095301&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt;  &lt;span class="mf"&gt;0.374037&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.272031&lt;/span&gt;
&lt;span class="mi"&gt;2&lt;/span&gt;  &lt;span class="mf"&gt;1.102625&lt;/span&gt;  &lt;span class="mf"&gt;0.725778&lt;/span&gt;
&lt;span class="mi"&gt;3&lt;/span&gt;  &lt;span class="mf"&gt;0.619485&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.356188&lt;/span&gt;
&lt;span class="mi"&gt;4&lt;/span&gt;  &lt;span class="mf"&gt;0.323979&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.632381&lt;/span&gt;
&lt;span class="mi"&gt;5&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.721451&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.087884&lt;/span&gt;
&lt;span class="mi"&gt;6&lt;/span&gt;  &lt;span class="mf"&gt;0.440051&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.442707&lt;/span&gt;
&lt;span class="mi"&gt;7&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.890141&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.627261&lt;/span&gt;

&lt;span class="c"&gt;# Another (more flexible) way to do the same:&lt;/span&gt;

&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ix&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;C&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Remove outliers (actually, clipping their values up to a&amp;nbsp;maximum):&lt;/h2&gt;
&lt;p&gt;For this example, let&amp;rsquo;s first add some outliers to the previous&amp;nbsp;df:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;outlier&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;choice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="p"&gt;)][&lt;/span&gt;&lt;span class="n"&gt;randint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;))]&lt;/span&gt; &lt;span class="o"&gt;*=&lt;/span&gt; &lt;span class="mf"&gt;3.0&lt;/span&gt;

&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;ID&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;system&lt;/span&gt;&lt;span class="si"&gt;%i&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;randint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;))]&lt;/span&gt;

&lt;span class="n"&gt;df&lt;/span&gt;
          &lt;span class="n"&gt;A&lt;/span&gt;         &lt;span class="n"&gt;B&lt;/span&gt;         &lt;span class="n"&gt;C&lt;/span&gt;         &lt;span class="n"&gt;D&lt;/span&gt;       &lt;span class="n"&gt;ID&lt;/span&gt;
&lt;span class="mi"&gt;0&lt;/span&gt;  &lt;span class="mf"&gt;1.891338&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;1.454207&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.021687&lt;/span&gt;  &lt;span class="mf"&gt;9.857711&lt;/span&gt;  &lt;span class="n"&gt;system2&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt;  &lt;span class="mf"&gt;1.122112&lt;/span&gt;  &lt;span class="mf"&gt;1.301607&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;1.316152&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.272031&lt;/span&gt;  &lt;span class="n"&gt;system3&lt;/span&gt;
&lt;span class="mi"&gt;2&lt;/span&gt;  &lt;span class="mf"&gt;1.102625&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;3.329858&lt;/span&gt;  &lt;span class="mf"&gt;1.058960&lt;/span&gt;  &lt;span class="mf"&gt;0.725778&lt;/span&gt;  &lt;span class="n"&gt;system3&lt;/span&gt;
&lt;span class="mi"&gt;3&lt;/span&gt;  &lt;span class="mf"&gt;0.619485&lt;/span&gt;  &lt;span class="mf"&gt;4.501923&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.370432&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;1.068563&lt;/span&gt;  &lt;span class="n"&gt;system3&lt;/span&gt;
&lt;span class="mi"&gt;4&lt;/span&gt;  &lt;span class="mf"&gt;0.323979&lt;/span&gt;  &lt;span class="mf"&gt;0.008434&lt;/span&gt;  &lt;span class="mf"&gt;0.616835&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.632381&lt;/span&gt;  &lt;span class="n"&gt;system2&lt;/span&gt;
&lt;span class="mi"&gt;5&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.721451&lt;/span&gt;  &lt;span class="mf"&gt;0.852577&lt;/span&gt;  &lt;span class="mf"&gt;1.071660&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.087884&lt;/span&gt;  &lt;span class="n"&gt;system3&lt;/span&gt;
&lt;span class="mi"&gt;6&lt;/span&gt;  &lt;span class="mf"&gt;0.440051&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;1.022366&lt;/span&gt;  &lt;span class="mf"&gt;1.807089&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.442707&lt;/span&gt;  &lt;span class="n"&gt;system2&lt;/span&gt;
&lt;span class="mi"&gt;7&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.890141&lt;/span&gt;  &lt;span class="mf"&gt;3.186248&lt;/span&gt;  &lt;span class="mf"&gt;0.959767&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.627261&lt;/span&gt;  &lt;span class="n"&gt;system1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;For example, if we know that values must lie in the range [-2, 2] we would like
to clip all entries with an absolute value &amp;gt;2 to exactly +/-&amp;nbsp;2.00.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;ID&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;ID&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;clip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lower&lt;/span&gt;&lt;span class="o"&gt;=-&lt;/span&gt;&lt;span class="mf"&gt;2.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;upper&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;2.0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;df&lt;/span&gt;
          &lt;span class="n"&gt;A&lt;/span&gt;         &lt;span class="n"&gt;B&lt;/span&gt;         &lt;span class="n"&gt;C&lt;/span&gt;         &lt;span class="n"&gt;D&lt;/span&gt;       &lt;span class="n"&gt;ID&lt;/span&gt;
&lt;span class="mi"&gt;0&lt;/span&gt;  &lt;span class="mf"&gt;1.891338&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;1.454207&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.021687&lt;/span&gt;  &lt;span class="mf"&gt;2.000000&lt;/span&gt;  &lt;span class="n"&gt;system2&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt;  &lt;span class="mf"&gt;1.122112&lt;/span&gt;  &lt;span class="mf"&gt;1.301607&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;1.316152&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.272031&lt;/span&gt;  &lt;span class="n"&gt;system3&lt;/span&gt;
&lt;span class="mi"&gt;2&lt;/span&gt;  &lt;span class="mf"&gt;1.102625&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;2.000000&lt;/span&gt;  &lt;span class="mf"&gt;1.058960&lt;/span&gt;  &lt;span class="mf"&gt;0.725778&lt;/span&gt;  &lt;span class="n"&gt;system3&lt;/span&gt;
&lt;span class="mi"&gt;3&lt;/span&gt;  &lt;span class="mf"&gt;0.619485&lt;/span&gt;  &lt;span class="mf"&gt;2.000000&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.370432&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;1.068563&lt;/span&gt;  &lt;span class="n"&gt;system3&lt;/span&gt;
&lt;span class="mi"&gt;4&lt;/span&gt;  &lt;span class="mf"&gt;0.323979&lt;/span&gt;  &lt;span class="mf"&gt;0.008434&lt;/span&gt;  &lt;span class="mf"&gt;0.616835&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.632381&lt;/span&gt;  &lt;span class="n"&gt;system2&lt;/span&gt;
&lt;span class="mi"&gt;5&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.721451&lt;/span&gt;  &lt;span class="mf"&gt;0.852577&lt;/span&gt;  &lt;span class="mf"&gt;1.071660&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.087884&lt;/span&gt;  &lt;span class="n"&gt;system3&lt;/span&gt;
&lt;span class="mi"&gt;6&lt;/span&gt;  &lt;span class="mf"&gt;0.440051&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;1.022366&lt;/span&gt;  &lt;span class="mf"&gt;1.807089&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.442707&lt;/span&gt;  &lt;span class="n"&gt;system2&lt;/span&gt;
&lt;span class="mi"&gt;7&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.890141&lt;/span&gt;  &lt;span class="mf"&gt;2.000000&lt;/span&gt;  &lt;span class="mf"&gt;0.959767&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.627261&lt;/span&gt;  &lt;span class="n"&gt;system1i&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Or directly using &lt;code&gt;np.where&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;numeric&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;ID&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;numeric&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;numeric&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mf"&gt;2.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                           &lt;span class="mf"&gt;2.0&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;sign&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;numeric&lt;/span&gt;&lt;span class="p"&gt;]),&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;numeric&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="pandas"></category><category term="python"></category></entry><entry><title>Mirror sharing with tmux/wemux</title><link href="http://fernandezcuesta.github.io/mirror-sharing-with-tmuxwemux.html" rel="alternate"></link><updated>2014-11-16T00:00:00+01:00</updated><author><name>J.M. Fernández</name></author><id>tag:fernandezcuesta.github.io,2014-11-16:mirror-sharing-with-tmuxwemux.html</id><summary type="html">&lt;p&gt;Fast and easy way to live sharing the screen, useful during upgrades where the
activities are to be audited&amp;nbsp;real-time.&lt;/p&gt;
&lt;p&gt;The following 2 components are in&amp;nbsp;place:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/zolrath/wemux"&gt;&lt;strong&gt;Wemux&lt;/strong&gt;&lt;/a&gt; and
&lt;a href="http://tmux.sourceforge.net/"&gt;&lt;strong&gt;tmux&lt;/strong&gt;&lt;/a&gt;, where the former acts as a wrapper
for &lt;code&gt;tmux&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;OpenSSH&lt;/strong&gt; configured in such a way that guests are directly attached to an
existing &lt;code&gt;wemux&lt;/code&gt; session (or disconnected&amp;nbsp;otherwise).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;&lt;a href="https://github.com/zolrath/wemux"&gt;&lt;strong&gt;Wemux&lt;/strong&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Assuming &lt;code&gt;tmux&lt;/code&gt; is already configured and working in the system, we can just
install wemux (&lt;code&gt;wemux-git&lt;/code&gt; in &lt;span class="caps"&gt;AUR&lt;/span&gt;). For the configuration we can either run
&lt;code&gt;wemux config&lt;/code&gt; or edit &lt;code&gt;/etc/wemux/wemux.conf&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;This is all I needed to change from the&amp;nbsp;defaults:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;host_list&lt;/span&gt;&lt;span class="o"&gt;=(&lt;/span&gt;my_local_username&lt;span class="o"&gt;)&lt;/span&gt;   &lt;span class="c"&gt;# only my own user will be running in host mode&lt;/span&gt;
&lt;span class="nv"&gt;default_client_mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;mirror&amp;quot;&lt;/span&gt;    &lt;span class="c"&gt;# all clients are attached read-only&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;OpenSSH&lt;/h2&gt;
&lt;p&gt;Create a guest user and set OpenSSH up as&amp;nbsp;follows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;table class="highlight_inline_table"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="c"&gt;#!/bin/bash&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 2&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="c"&gt;# Ensure only public key authentication is allowed&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 3&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo sed -E -i.bak &lt;span class="s1"&gt;&amp;#39;s/^#?(PasswordAuthentication|ChallengeResponseAuthentication).*$/\1 no/&amp;#39;&lt;/span&gt; /etc/ssh/sshd_config
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 4&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 5&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="c"&gt;# Create new guest user&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 6&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo useradd -m guest
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 7&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;guestpassword\nguestpassword&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sudo passwd guest
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 8&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 9&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="c"&gt;# Create ssh key for guest&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;10&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;su - guest
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;11&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;mkdir .ssh
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;12&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;ssh-keygen -N MY_PASSPHRASE -f ~/.ssh/guest-ssh-key
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;13&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s1"&gt;&amp;#39;command=&amp;#8221;wemux&amp;#8221;,no-port-forwarding,no-x11-forwarding,no-agent-forwarding &amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; ~/.ssh/authorized_keys 
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;14&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;cat ~/.ssh/guest-ssh-key.pub &amp;gt;&amp;gt; ~/.ssh/authorized_keys
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now share keys to the other party over a secure&amp;nbsp;channel.&lt;/p&gt;
&lt;h1&gt;&amp;lt;tl;dr&amp;gt;&lt;/h1&gt;
&lt;p&gt;Or &lt;strong&gt;much easier and more secure&lt;/strong&gt;, if the other party has a &lt;strong&gt;github&lt;/strong&gt; account both
steps above can be shorten by using &lt;code&gt;github-auth&lt;/code&gt; with a simple&amp;nbsp;command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;gh-auth add --command&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wemux client mirror&amp;quot;&lt;/span&gt; --users&lt;span class="o"&gt;=&lt;/span&gt;GITHUB_USER_ID
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This will add the user’s keys straight to our &lt;code&gt;~/.ssh/authorized&lt;/code&gt; keys and force
the connection matching the keys to attach as mirror clients to the existing
&lt;code&gt;wemux&lt;/code&gt; session.&lt;/p&gt;
&lt;p&gt;Removing the keys is even easier&amp;nbsp;with:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;gh-auth remove --users&lt;span class="o"&gt;=&lt;/span&gt;GITHUB_USER_ID
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;br/&gt;&lt;/p&gt;
&lt;h2&gt;&lt;u&gt;&lt;span class="caps"&gt;UPDATE&lt;/span&gt;:&lt;/u&gt; When wemux is not an&amp;nbsp;option&lt;/h2&gt;
&lt;p&gt;If &lt;code&gt;wemux&lt;/code&gt; is not an option, we can still reach the same results only by using
&lt;code&gt;tmux&lt;/code&gt; and&amp;nbsp;OpenSSH.&lt;/p&gt;
&lt;p&gt;What we need from the host is to open a tmux session with a specific name,
for&amp;nbsp;example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;tmux new-session -s shared
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And add an authorized key to the &lt;code&gt;~/.ssh/authorized_keys&lt;/code&gt; file for the user
that started the tmux session,&amp;nbsp;like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s1"&gt;&amp;#39;command=&amp;quot;tmux attach-session -t session -r&amp;quot;&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; ~/.ssh/authorized_keys
&lt;span class="nv"&gt;$ &lt;/span&gt;cat ~/.ssh/guest-ssh-key.pub &amp;gt;&amp;gt; ~/.ssh/authorized_keys
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The end user will have to log in with
&lt;code&gt;ssh user@your-host-name:REDIRECTED_PORT -i guest-ssh-key&lt;/code&gt; where &lt;code&gt;user&lt;/code&gt; is
the one owning the tmux&amp;nbsp;server.&lt;/p&gt;</summary><category term="linux"></category><category term="networking"></category><category term="agile"></category><category term="iptables"></category></entry><entry><title>Sharing a VPN session</title><link href="http://fernandezcuesta.github.io/sharing-a-vpn-session.html" rel="alternate"></link><updated>2014-11-14T00:00:00+01:00</updated><author><name>J.M. Fernández</name></author><id>tag:fernandezcuesta.github.io,2014-11-14:sharing-a-vpn-session.html</id><summary type="html">&lt;p&gt;Sometimes it may happen that we need to share the connection to a remote system
with another person who cannot connect directly.
In order to move on, there are quite a few options. Amongst&amp;nbsp;others:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Using a shared tmux session while the connection is established, which
requires the other person to feel comfortable with&amp;nbsp;tmux.&lt;/li&gt;
&lt;li&gt;Setting up a &lt;span class="caps"&gt;VPN&lt;/span&gt; to my&amp;nbsp;system.&lt;/li&gt;
&lt;li&gt;Setting up an &lt;u&gt;&lt;strong&gt;&lt;span class="caps"&gt;SSH&lt;/span&gt; tunnel&lt;/strong&gt;&lt;/u&gt; listening in our outbound&amp;nbsp;interface.&lt;/li&gt;
&lt;li&gt;Setting up &lt;em&gt;a couple&lt;/em&gt; of &lt;u&gt;&lt;strong&gt;iptables&lt;/strong&gt;&lt;/u&gt; rules.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;On this article I&amp;rsquo;ll describe &lt;strong&gt;last two options&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;For completeness, let&amp;rsquo;s summarize the components in the&amp;nbsp;game:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;span class="caps"&gt;VPN&lt;/span&gt; session is established from my laptop, which has a private &lt;span class="caps"&gt;IP&lt;/span&gt; address
behind a &lt;span class="caps"&gt;NAT&lt;/span&gt; (actually behind 2 NATs, which is not&amp;nbsp;relevant).&lt;/li&gt;
&lt;li&gt;Broadband router has a dynamically assigned public &lt;span class="caps"&gt;IP&lt;/span&gt; provided by my &lt;span class="caps"&gt;ISP&lt;/span&gt;.&lt;/li&gt;
&lt;li&gt;There already exist a port range forwarded from the router straight to my
laptop both for &lt;span class="caps"&gt;UDP&lt;/span&gt; and &lt;span class="caps"&gt;TCP&lt;/span&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So at the end, the details (as an example)&amp;nbsp;are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;My public &lt;span class="caps"&gt;IP&lt;/span&gt;: &lt;code&gt;1.1.1.1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Open port to my system: &lt;code&gt;50000&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Assigned &lt;span class="caps"&gt;IP&lt;/span&gt; address from the &lt;span class="caps"&gt;VPN&lt;/span&gt; tunnel: &lt;code&gt;10.200.100.5&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Remote system reachable from the IPSec tunnel: &lt;code&gt;10.200.0.1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The &lt;u&gt;&lt;strong&gt;simplest option&lt;/strong&gt;&lt;/u&gt; is taking advantage of OpenSSH&amp;rsquo;s ability to forward
incoming connections into the &lt;span class="caps"&gt;SSH&lt;/span&gt;&amp;nbsp;tunnel:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;ssh user@10.200.0.1 -L 1.1.1.1:50000:localhost:22
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And let the other person connect to 1.1.1.1:50000.
This works great &lt;strong&gt;as long as we keep our &lt;span class="caps"&gt;SSH&lt;/span&gt; session open&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;An alternative using &lt;code&gt;iptables&lt;/code&gt; does not have this&amp;nbsp;constrain.&lt;/p&gt;
&lt;p&gt;Having a look at iptables flowchart, we may figure out what we need to set it
up by following the upper side of the
&lt;a href="http://www.fclose.com/816/port-forwarding-using-iptables/"&gt;chart&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;PACKET IN
    |
PREROUTING--[routing]--&amp;gt;--FORWARD--&amp;gt;--POSTROUTING--&amp;gt;--OUT
 - nat (dst)   |           - filter      - nat (src)
               |                            |
               |                            |
              INPUT                       OUTPUT
              - filter                    - nat (dst)
               |                          - filter
               |                            |
               `-----&amp;gt;-----[app]-----&amp;gt;------&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;span class="caps"&gt;PREROUTING&lt;/span&gt; rule on &lt;span class="caps"&gt;NAT&lt;/span&gt; table to translate incoming connections on port 50000
to the remote system port 22 (&lt;span class="caps"&gt;SSH&lt;/span&gt;).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;iptables -t nat -A PREROUTING -p tcp --dport &lt;span class="m"&gt;50000&lt;/span&gt; -j DNAT --to &lt;span class="se"&gt;\&lt;/span&gt;
&amp;gt; 10.200.0.1:22 -m comment --comment &lt;span class="s1"&gt;&amp;#39;Redirect in 50000 to 10.200.0.1:22&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;span class="caps"&gt;FORWARD&lt;/span&gt; rule to allow this traffic flow between interfaces (&lt;code&gt;eth0&lt;/code&gt; and &lt;code&gt;tun0&lt;/code&gt;).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;iptables -I FORWARD -p tcp --dst 10.200.0.1 --dport &lt;span class="m"&gt;22&lt;/span&gt; -j ACCEPT
&lt;span class="nv"&gt;$ &lt;/span&gt;iptables -I FORWARD -p tcp --src 10.200.0.1 --sport &lt;span class="m"&gt;22&lt;/span&gt; -j ACCEPT
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This also needs the kernel to allow &lt;span class="caps"&gt;IP&lt;/span&gt; forwarding, so we must&amp;nbsp;check:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;cat /proc/sys/net/ipv4/ip_forward&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&amp;gt; sudo sysctl -w net.ipv4.ip_forward&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;span class="caps"&gt;POSTROUTING&lt;/span&gt; rule on &lt;span class="caps"&gt;NAT&lt;/span&gt; table to masquerade the source address of outgoing&amp;nbsp;traffic.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;iptables -t nat -A POSTROUTING -d 10.200.0.1 -p tcp --dport &lt;span class="m"&gt;22&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&amp;gt; -j SNAT --to-source 10.200.100.5
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With these rules in place the other person can simply access the remote system&amp;nbsp;with:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;ssh username@1.1.1.1 -p 50000
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The overall process can be automated with a bash script like&amp;nbsp;this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;table class="highlight_inline_table"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;  1&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="c"&gt;#!/bin/bash&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;  2&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;  3&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;GW_PORT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;22&lt;/span&gt;            &lt;span class="c"&gt;# default gateway port&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;  4&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;GW_IP&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;127.0.0.1       &lt;span class="c"&gt;# default gateway ip address&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;  5&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;FWD_PORT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;8000&lt;/span&gt;         &lt;span class="c"&gt;# default forwarding port, must be reachable from remote&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;  6&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;&lt;span class="caps"&gt;COMMENT&lt;/span&gt;&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8220;Added by vpn_fwd&amp;#8221;&lt;/span&gt;   &lt;span class="c"&gt;# comment added to iptables rules&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;  7&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;  8&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nv"&gt;disable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;false&lt;/span&gt;   &lt;span class="c"&gt;# unless specified, default action is to enable the forwarding&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;  9&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 10&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;usage&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 11&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nb"&gt;read&lt;/span&gt; -d &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span class="nb"&gt;help&lt;/span&gt; &lt;span class="s"&gt;&amp;lt;&amp;lt;- &lt;span class="caps"&gt;EOF&lt;/span&gt;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 12&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="s"&gt;  Usage: vpn_fwd  gw-ip   gateway ip (defaults to $GW_IP)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 13&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="s"&gt;                 [&amp;#8212;gw-port]   gateway port (defaults to $GW_PORT)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 14&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="s"&gt;                 [&amp;#8212;fwd-port]   forwarding port (defaults to $FWD_PORT)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 15&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="s"&gt;                 [&amp;#8212;iface]   &lt;span class="caps"&gt;VPN&lt;/span&gt; interface name (default, first &lt;span class="caps"&gt;PPP&lt;/span&gt; interface&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 16&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="s"&gt;                                                 found)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 17&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 18&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="s"&gt;         vpn_fwd disable    disable port forwarding to &lt;span class="caps"&gt;VPN&lt;/span&gt;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 19&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 20&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="s"&gt;  Example:&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 21&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="s"&gt;         vpn_fwd 10.10.10.1  # redirects port 8000 to 10.10.10.1:22&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 22&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="s"&gt;         vpn_fwd my_gw_host &amp;#8212;fwd-port 44000 &amp;#8212;iface tun2&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 23&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="s"&gt;&lt;span class="caps"&gt;EOF&lt;/span&gt;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 24&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="nv"&gt;$help&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 25&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 26&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 27&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;guess_ip&lt;span class="o"&gt;(){&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 28&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="c"&gt;# Look for the &lt;span class="caps"&gt;VPN&lt;/span&gt; assigned &lt;span class="caps"&gt;IP&lt;/span&gt; address (first &lt;span class="caps"&gt;PPP&lt;/span&gt; interface if nothing given)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 29&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -z &lt;span class="s2"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="nv"&gt;$VPN_IF&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 30&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;   &lt;span class="nv"&gt;VPN_IF&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;ifconfig &lt;span class="p"&gt;|&lt;/span&gt; grep -Pom1 &lt;span class="s1"&gt;&amp;#39;.*(?=:\sflags=\d+&amp;lt;[\w,]*&lt;span class="caps"&gt;POINTOPOINT&lt;/span&gt;)&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 31&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 32&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="nv"&gt;$VPN_IF&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 33&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;   ifconfig &lt;span class="nv"&gt;$VPN_IF&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep -Po &lt;span class="se"&gt;\&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 34&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;   &lt;span class="s1"&gt;&amp;#39;\s*inet\s+\K\b(?:\d{1,3}&amp;#46;){3}\d{1,3}\b(?=\s+netmask.*)&amp;#39;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 35&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 36&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 37&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 38&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 39&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 40&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;enable_fwd&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 41&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="c"&gt;# Enable &lt;span class="caps"&gt;IP&lt;/span&gt; forwarding if not already&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 42&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;cat /proc/sys/net/ipv4/ip_forward&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 43&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;  sudo sysctl -w net.ipv4.ip_forward&lt;span class="o"&gt;=&lt;/span&gt;1
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 44&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 45&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 46&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="nv"&gt;$GW_IP&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;#8220;127.0.0.1&amp;#8221;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 47&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    &lt;span class="nv"&gt;VPN_IP&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$GW_IP&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 48&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;else&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 49&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    &lt;span class="nv"&gt;VPN_IP&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;guess_ip&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 50&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 51&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 52&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="nv"&gt;$VPN_IP&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 53&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    &lt;span class="c"&gt;# Set up iptables rules&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 54&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    sudo iptables -t nat -A &lt;span class="caps"&gt;PREROUTING&lt;/span&gt; -p tcp &amp;#8212;dport &lt;span class="nv"&gt;$FWD_PORT&lt;/span&gt; -j &lt;span class="caps"&gt;DNAT&lt;/span&gt; &amp;#8212;to &lt;span class="se"&gt;\&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 55&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    &lt;span class="nv"&gt;$GW_IP&lt;/span&gt;:&lt;span class="nv"&gt;$GW_PORT&lt;/span&gt; -m comment &amp;#8212;comment &lt;span class="s2"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;&lt;span class="caps"&gt;COMMENT&lt;/span&gt;&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 56&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    sudo iptables -I &lt;span class="caps"&gt;FORWARD&lt;/span&gt; -p tcp &amp;#8212;dst &lt;span class="nv"&gt;$GW_IP&lt;/span&gt; &amp;#8212;dport &lt;span class="nv"&gt;$GW_PORT&lt;/span&gt; -j &lt;span class="caps"&gt;ACCEPT&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 57&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    -m comment &amp;#8212;comment &lt;span class="s2"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;&lt;span class="caps"&gt;COMMENT&lt;/span&gt;&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 58&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    sudo iptables -I &lt;span class="caps"&gt;FORWARD&lt;/span&gt; -p tcp &amp;#8212;src &lt;span class="nv"&gt;$GW_IP&lt;/span&gt; &amp;#8212;sport &lt;span class="nv"&gt;$GW_PORT&lt;/span&gt; -j &lt;span class="caps"&gt;ACCEPT&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 59&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    -m comment &amp;#8212;comment &lt;span class="s2"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;&lt;span class="caps"&gt;COMMENT&lt;/span&gt;&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 60&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    sudo iptables -t nat -A &lt;span class="caps"&gt;POSTROUTING&lt;/span&gt; -d &lt;span class="nv"&gt;$GW_IP&lt;/span&gt; -p tcp &amp;#8212;dport &lt;span class="nv"&gt;$GW_PORT&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 61&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    -j &lt;span class="caps"&gt;SNAT&lt;/span&gt; &amp;#8212;to-source &lt;span class="nv"&gt;$VPN_IP&lt;/span&gt; -m comment &amp;#8212;comment &lt;span class="s2"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;&lt;span class="caps"&gt;COMMENT&lt;/span&gt;&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 62&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;else&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 63&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    ifconfig -a
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 64&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;No &lt;span class="caps"&gt;POINTOPOINT&lt;/span&gt; interface was found up&amp;#8230;&amp;#39;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 65&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 66&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 67&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 68&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;disable_fwd&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 69&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="c"&gt;# Delete all iptables rules with $&lt;span class="caps"&gt;COMMENT&lt;/span&gt;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 70&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;sudo sh -c &lt;span class="s1"&gt;&amp;#39;iptables-save | grep -v &amp;#8220;${&lt;span class="caps"&gt;COMMENT&lt;/span&gt;}&amp;#8221; | iptables-restore&amp;#39;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 71&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Forwarding disabled&amp;#39;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 72&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;sudo iptables-save &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="s2"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;&lt;span class="caps"&gt;COMMENT&lt;/span&gt;&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 73&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 74&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 75&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;main&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 76&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[[&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;#8220;disable&amp;#8221;&lt;/span&gt; &lt;span class="o"&gt;]]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 77&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;       &lt;span class="nv"&gt;disable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 78&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nb"&gt;       &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt; 1
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 79&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    &lt;span class="k"&gt;else&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 80&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;       &lt;span class="nv"&gt;GW_IP&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;dig +short &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;  &lt;span class="c"&gt;#mandatory as first argument&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 81&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;       &lt;span class="nb"&gt;shift&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 82&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="nb"&gt;    &lt;/span&gt;&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 83&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="o"&gt;[[&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &lt;span class="o"&gt;]]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 84&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="s2"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt; in
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 85&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;            &amp;#8212;gw-port&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 86&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;                &lt;span class="nv"&gt;GW_PORT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;2&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 87&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;                &lt;span class="nb"&gt;shift&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 88&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;                &lt;span class="p"&gt;;;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 89&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;            &amp;#8212;fwd-port&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 90&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;                &lt;span class="nv"&gt;FWD_PORT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;2&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 91&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;                &lt;span class="nb"&gt;shift&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 92&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;                &lt;span class="p"&gt;;;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 93&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;            &amp;#8212;iface&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 94&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;                &lt;span class="nv"&gt;VPN_IF&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;2&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 95&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;                &lt;span class="nb"&gt;shift&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 96&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;                &lt;span class="p"&gt;;;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 97&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;            *&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 98&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;                &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;#8220;Unknown parameter: &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;2
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 99&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;                usage
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;100&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;                &lt;span class="k"&gt;return&lt;/span&gt; 1
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;101&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;        &lt;span class="k"&gt;esac&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;102&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;103&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; ! &lt;span class="nb"&gt;shift&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;104&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;            &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Missing parameter argument.&amp;#39;&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;2
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;105&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;            usage
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;106&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;            &lt;span class="k"&gt;return&lt;/span&gt; 1
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;107&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;        &lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;108&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    &lt;span class="k"&gt;done&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;109&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;110&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;111&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -z &lt;span class="s2"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;112&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    usage
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;113&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;else&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;114&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    main &lt;span class="s2"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;#8221;&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;115&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;$disable&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt; disable_fwd&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; enable_fwd&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;116&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/pre&gt;&lt;/div&gt;</summary><category term="security"></category><category term="linux"></category><category term="networking"></category><category term="iptables"></category></entry><entry><title>Combining pandas dataframes</title><link href="http://fernandezcuesta.github.io/combining-pandas-dataframes.html" rel="alternate"></link><updated>2014-11-07T00:00:00+01:00</updated><author><name>J.M. Fernández</name></author><id>tag:fernandezcuesta.github.io,2014-11-07:combining-pandas-dataframes.html</id><summary type="html">&lt;p&gt;Although still touching bases with pandas I came across a problem whose
answer was not found after skimming through Wes McKinney&amp;rsquo;s &lt;a href="http://www.bookdepository.com/Python-for-Data-Analysis-Wes-McKinney/9781449319793"&gt;&lt;em&gt;&amp;ldquo;Python for Data
 Analysis&amp;rdquo;&lt;/em&gt;&lt;/a&gt;&amp;nbsp;book.&lt;/p&gt;
&lt;p&gt;Long story short, starting with a bunch of &lt;span class="caps"&gt;CSV&lt;/span&gt; files transferred from a remote
system, a series of dataframes are produced one corresponding to each file.
These CSVs may contain hetereogeneous information from different components,
not necessarily for the very same&amp;nbsp;period.&lt;/p&gt;
&lt;p&gt;As an example, let&amp;rsquo;s assume the index being the sample indicator. For simplicity
all the tests are done with these&amp;nbsp;dataframes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;df_a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;sample_nr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
                     &lt;span class="s"&gt;&amp;#39;val0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
                     &lt;span class="s"&gt;&amp;#39;val1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]})&lt;/span&gt;
&lt;span class="n"&gt;df_a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df_a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_index&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;sample_nr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;df_b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;sample_nr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
                     &lt;span class="s"&gt;&amp;#39;val2&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
                     &lt;span class="s"&gt;&amp;#39;val3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]})&lt;/span&gt;
&lt;span class="n"&gt;df_b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df_b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_index&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;sample_nr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;df_c&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;sample_nr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
                     &lt;span class="s"&gt;&amp;#39;val0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
                     &lt;span class="s"&gt;&amp;#39;val1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]})&lt;/span&gt;
&lt;span class="n"&gt;df_c&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df_c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_index&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;sample_nr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;df_d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;sample_nr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
                     &lt;span class="s"&gt;&amp;#39;val2&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
                     &lt;span class="s"&gt;&amp;#39;val3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]})&lt;/span&gt;
&lt;span class="n"&gt;df_d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df_d&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_index&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;sample_nr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Which has as&amp;nbsp;result:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;df_a&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;                         &lt;span class="n"&gt;df_b&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
           &lt;span class="n"&gt;val0&lt;/span&gt;  &lt;span class="n"&gt;val1&lt;/span&gt;                   &lt;span class="n"&gt;val2&lt;/span&gt;  &lt;span class="n"&gt;val3&lt;/span&gt;
&lt;span class="n"&gt;sample_nr&lt;/span&gt;                    &lt;span class="n"&gt;sample_nr&lt;/span&gt;  
&lt;span class="mi"&gt;0&lt;/span&gt;             &lt;span class="mi"&gt;2&lt;/span&gt;     &lt;span class="mi"&gt;1&lt;/span&gt;    &lt;span class="mi"&gt;10&lt;/span&gt;            &lt;span class="mi"&gt;5&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt;             &lt;span class="mi"&gt;3&lt;/span&gt;     &lt;span class="mi"&gt;2&lt;/span&gt;    &lt;span class="mi"&gt;11&lt;/span&gt;            &lt;span class="mi"&gt;4&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="mi"&gt;2&lt;/span&gt;             &lt;span class="mi"&gt;6&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;    &lt;span class="mi"&gt;12&lt;/span&gt;            &lt;span class="mi"&gt;5&lt;/span&gt;     &lt;span class="mi"&gt;6&lt;/span&gt;
&lt;span class="mi"&gt;3&lt;/span&gt;             &lt;span class="mi"&gt;8&lt;/span&gt;     &lt;span class="mi"&gt;3&lt;/span&gt;    &lt;span class="mi"&gt;13&lt;/span&gt;            &lt;span class="mi"&gt;5&lt;/span&gt;     &lt;span class="mi"&gt;6&lt;/span&gt;


&lt;span class="n"&gt;df_c&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;                    &lt;span class="n"&gt;df_d&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
           &lt;span class="n"&gt;val0&lt;/span&gt;  &lt;span class="n"&gt;val1&lt;/span&gt;               &lt;span class="n"&gt;val2&lt;/span&gt;  &lt;span class="n"&gt;val3&lt;/span&gt;
&lt;span class="n"&gt;sample_nr&lt;/span&gt;                &lt;span class="n"&gt;sample_nr&lt;/span&gt;
&lt;span class="mi"&gt;10&lt;/span&gt;            &lt;span class="mi"&gt;1&lt;/span&gt;     &lt;span class="mi"&gt;0&lt;/span&gt;    &lt;span class="mi"&gt;0&lt;/span&gt;             &lt;span class="mi"&gt;8&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;            &lt;span class="mi"&gt;3&lt;/span&gt;     &lt;span class="mi"&gt;2&lt;/span&gt;    &lt;span class="mi"&gt;1&lt;/span&gt;             &lt;span class="mi"&gt;8&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="mi"&gt;12&lt;/span&gt;            &lt;span class="mi"&gt;2&lt;/span&gt;     &lt;span class="mi"&gt;3&lt;/span&gt;    &lt;span class="mi"&gt;2&lt;/span&gt;             &lt;span class="mi"&gt;7&lt;/span&gt;     &lt;span class="mi"&gt;6&lt;/span&gt;
&lt;span class="mi"&gt;13&lt;/span&gt;            &lt;span class="mi"&gt;1&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;    &lt;span class="mi"&gt;3&lt;/span&gt;             &lt;span class="mi"&gt;7&lt;/span&gt;     &lt;span class="mi"&gt;6&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The result of glueing everything together&amp;nbsp;is:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;{df_a, df_c} and {df_d, df_b} are concatenated along their axis (as the result
of &lt;code&gt;df_a.merge(df_c, how='outer')&lt;/code&gt;).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;{df_a, df_d} and {df_c, df_b} are put together horizontally, as we could get
by running &lt;code&gt;df_a.join(df_d)&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;But&amp;hellip; &lt;strong&gt;what if&lt;/strong&gt; we have not a-priori clue of how each operands look like and
would like to perform a &amp;ldquo;glue &lt;em&gt;all together now&lt;/em&gt;&amp;rdquo;&amp;nbsp;operation?&lt;/p&gt;
&lt;h1&gt;&amp;lt;tl;dr/&amp;gt;&lt;/h1&gt;
&lt;p&gt;At this point, I found two&amp;nbsp;options:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Using &lt;code&gt;pd.concat&lt;/code&gt; function.&lt;/li&gt;
&lt;li&gt;Using &lt;code&gt;pd.combine_first&lt;/code&gt; function.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The latter was at first glance the simplest&amp;nbsp;choice:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;_df&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;df_a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;df_b&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;df_c&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;df_d&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
    &lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;combine_first&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;which produces the desired&amp;nbsp;output:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
           &lt;span class="n"&gt;val0&lt;/span&gt;  &lt;span class="n"&gt;val1&lt;/span&gt;  &lt;span class="n"&gt;val2&lt;/span&gt;  &lt;span class="n"&gt;val3&lt;/span&gt;
&lt;span class="n"&gt;sample_nr&lt;/span&gt;
&lt;span class="mi"&gt;0&lt;/span&gt;             &lt;span class="mi"&gt;2&lt;/span&gt;     &lt;span class="mi"&gt;1&lt;/span&gt;     &lt;span class="mi"&gt;8&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt;             &lt;span class="mi"&gt;3&lt;/span&gt;     &lt;span class="mi"&gt;2&lt;/span&gt;     &lt;span class="mi"&gt;8&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="mi"&gt;2&lt;/span&gt;             &lt;span class="mi"&gt;6&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;     &lt;span class="mi"&gt;7&lt;/span&gt;     &lt;span class="mi"&gt;6&lt;/span&gt;
&lt;span class="mi"&gt;3&lt;/span&gt;             &lt;span class="mi"&gt;8&lt;/span&gt;     &lt;span class="mi"&gt;3&lt;/span&gt;     &lt;span class="mi"&gt;7&lt;/span&gt;     &lt;span class="mi"&gt;6&lt;/span&gt;
&lt;span class="mi"&gt;10&lt;/span&gt;            &lt;span class="mi"&gt;1&lt;/span&gt;     &lt;span class="mi"&gt;0&lt;/span&gt;     &lt;span class="mi"&gt;5&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;            &lt;span class="mi"&gt;3&lt;/span&gt;     &lt;span class="mi"&gt;2&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="mi"&gt;12&lt;/span&gt;            &lt;span class="mi"&gt;2&lt;/span&gt;     &lt;span class="mi"&gt;3&lt;/span&gt;     &lt;span class="mi"&gt;5&lt;/span&gt;     &lt;span class="mi"&gt;6&lt;/span&gt;
&lt;span class="mi"&gt;13&lt;/span&gt;            &lt;span class="mi"&gt;1&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;     &lt;span class="mi"&gt;5&lt;/span&gt;     &lt;span class="mi"&gt;6&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The first option was, however, my choice due to the way that input data is&amp;nbsp;obtained:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;concat&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;dataframize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a_file&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;a_file&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;files&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;axis&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Where &lt;code&gt;dataframize&lt;/code&gt; simply takes an input &lt;span class="caps"&gt;CSV&lt;/span&gt; and returns a pd.DataFrame()
object.
The outcome still needs some adjustment (indices are duplicate and half of the 
values are&amp;nbsp;empty).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
           &lt;span class="n"&gt;val0&lt;/span&gt;  &lt;span class="n"&gt;val1&lt;/span&gt;  &lt;span class="n"&gt;val2&lt;/span&gt;  &lt;span class="n"&gt;val3&lt;/span&gt;
&lt;span class="n"&gt;sample_nr&lt;/span&gt;
&lt;span class="mi"&gt;0&lt;/span&gt;             &lt;span class="mi"&gt;2&lt;/span&gt;     &lt;span class="mi"&gt;1&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt;             &lt;span class="mi"&gt;3&lt;/span&gt;     &lt;span class="mi"&gt;2&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;
&lt;span class="mi"&gt;2&lt;/span&gt;             &lt;span class="mi"&gt;6&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;
&lt;span class="mi"&gt;3&lt;/span&gt;             &lt;span class="mi"&gt;8&lt;/span&gt;     &lt;span class="mi"&gt;3&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;
&lt;span class="mi"&gt;0&lt;/span&gt;           &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;     &lt;span class="mi"&gt;8&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt;           &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;     &lt;span class="mi"&gt;8&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="mi"&gt;2&lt;/span&gt;           &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;     &lt;span class="mi"&gt;7&lt;/span&gt;     &lt;span class="mi"&gt;6&lt;/span&gt;
&lt;span class="mi"&gt;3&lt;/span&gt;           &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;     &lt;span class="mi"&gt;7&lt;/span&gt;     &lt;span class="mi"&gt;6&lt;/span&gt;
&lt;span class="mi"&gt;10&lt;/span&gt;            &lt;span class="mi"&gt;1&lt;/span&gt;     &lt;span class="mi"&gt;0&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;            &lt;span class="mi"&gt;3&lt;/span&gt;     &lt;span class="mi"&gt;2&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;
&lt;span class="mi"&gt;12&lt;/span&gt;            &lt;span class="mi"&gt;2&lt;/span&gt;     &lt;span class="mi"&gt;3&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;
&lt;span class="mi"&gt;13&lt;/span&gt;            &lt;span class="mi"&gt;1&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;
&lt;span class="mi"&gt;10&lt;/span&gt;          &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;     &lt;span class="mi"&gt;5&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;          &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;     &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="mi"&gt;12&lt;/span&gt;          &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;     &lt;span class="mi"&gt;5&lt;/span&gt;     &lt;span class="mi"&gt;6&lt;/span&gt;
&lt;span class="mi"&gt;13&lt;/span&gt;          &lt;span class="kc"&gt;NaN&lt;/span&gt;   &lt;span class="kc"&gt;NaN&lt;/span&gt;     &lt;span class="mi"&gt;5&lt;/span&gt;     &lt;span class="mi"&gt;6&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So at the end this was the code&amp;nbsp;used:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;concat&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;dataframize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a_file&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;a_file&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;files&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;axis&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c"&gt;# properly merge the columns and restore the metadata&lt;/span&gt;
&lt;span class="n"&gt;_df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;groupby&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The real reason of why choosing this and not &lt;code&gt;pd.combine_first&lt;/code&gt;&amp;hellip; maybe
in a future&amp;nbsp;post.&lt;/p&gt;</summary><category term="pandas"></category><category term="python"></category><category term="code"></category></entry><entry><title>Logical disks in OpenVMS</title><link href="http://fernandezcuesta.github.io/logical-disks-in-openvms.html" rel="alternate"></link><updated>2014-10-30T00:00:00+01:00</updated><author><name>J.M. Fernández</name></author><id>tag:fernandezcuesta.github.io,2014-10-30:logical-disks-in-openvms.html</id><summary type="html">&lt;p&gt;There are situations where an operator wants to run some custom scripts on
their systems. These scripts might not be fully optimized and be the root
cause for bigger problems in the overall system behaviour.
It is also quite common to be asked for a way to &lt;em&gt;&amp;lsquo;restrict&amp;rsquo;&lt;/em&gt; the amount of
log or output files that a script can generate, in a way that the main
services running on the system are not affected by a lack of&amp;nbsp;space.&lt;/p&gt;
&lt;p&gt;A way to manage this is by controlling the number of log or output files to
be written to a specific directory.
This can be done with the &lt;code&gt;SET DIRECTORY /VERSION_LIMIT&lt;/code&gt; or even for
individual files with &lt;code&gt;SET FILE /VERSION_LIMIT&lt;/code&gt; commands.&lt;/p&gt;
&lt;p&gt;Another way to accomplish it is by defining a &lt;strong&gt;Logical Disk (&lt;span class="caps"&gt;LD&lt;/span&gt;)&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;u&gt;&lt;strong&gt;LDdriver&lt;/strong&gt;&lt;/u&gt; allows OpenVMS to create a logical volume that physically
resides on a single file. Similar to loop devices on Linux.
The size of the virtual volume can be as big as the real volume where the file
is saved can&amp;nbsp;store.&lt;/p&gt;
&lt;p&gt;A couple of use&amp;nbsp;cases:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Burn a &lt;span class="caps"&gt;CD&lt;/span&gt; with an OpenVMS directory structure. Create a &lt;span class="caps"&gt;LD&lt;/span&gt;, mount it,
copy directories to virtual volume and disconnect.
The container file can now be burnt to a &lt;span class="caps"&gt;CD&lt;/span&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Shrink a script not to fill up a disk. Assign the working directory to a &lt;span class="caps"&gt;LD&lt;/span&gt;
with a specific size. Even if the virtual volume is 100% full, the real disk
will not be affected (think about a &lt;span class="caps"&gt;8GB&lt;/span&gt; virtual disk residing on a &lt;span class="caps"&gt;100GB&lt;/span&gt;&amp;nbsp;volume).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&amp;gt; ld help

 LD

 The logical disk utility is a system management tool available to any user for controlling logical disk usage.
 A Logical Disk is a file available on a Physical Disk, which acts as a real Physical Disk (the file may or may not be contiguous).
 The Logical Disks are available in any directory of the Physical Disk.
 A large disk can be divided into smaller sections, each a Logical Disk, supporting the same I/O functions as the Physical Disk.
 By giving the Logical Disk File a good protection level and mounting it private or with device protection, you are able to add a number of protection
 levels to your file system.
 The logical disk is controlled by the LD utility, which can be directly invoked from DCL.

Format:

LD [/qualifiers] [Filespec] [Device]

Additional information available:

Author Command_summary Driver_functions Error_messages
Features HELP New_features_V5.0 New_features_V5.1
New_features_V6.0 New_features_V6.2 New_features_V6.3
New_features_V7.0 New_features_V8.0 New_features_V8.1
New_features_V8.2 Parameters Privileges_and_Quotas Restrictions
Setup IO_Trace_example CONNECT CREATE DISCONNECT NOPROTECT
NOWATCH SHOW TRACE NOTRACE PROTECT WATCH VERSION
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Example&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Add the startup procedures to the &lt;code&gt;SYS$STARTUP:SYSTARTUP_VMS.COM&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;If f&lt;span class="nv"&gt;$search&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sys&lt;/span&gt;&lt;span class="nv"&gt;$startup&lt;/span&gt;&lt;span class="s2"&gt;:ld&lt;/span&gt;&lt;span class="nv"&gt;$startup&lt;/span&gt;&lt;span class="s2"&gt;.com&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; .nes. Then @SYS&lt;span class="nv"&gt;$STARTUP&lt;/span&gt;:LD&lt;span class="nv"&gt;$STARTUP&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;Note that this will be executed during system boot. If a reboot is not
possible, invoke it manually from the system prompt with
&lt;code&gt;@SYS$STARTUP:LD$STARTUP&lt;/code&gt;, then continue with the next&amp;nbsp;steps&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Create a 100MBlock (&lt;span class="caps"&gt;40MB&lt;/span&gt;) logical drive&amp;nbsp;file&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;&amp;gt; ld create &lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;1&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;dga200&lt;/span&gt;&lt;span class="x"&gt;:[repository]ldisk1.dsk /size=100000 /nobackup [/contiguous]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Connect&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;ld&lt;/span&gt; &lt;span class="nt"&gt;connect&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nt"&gt;1&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nt"&gt;dga200&lt;/span&gt;&lt;span class="nd"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;repository&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="nd"&gt;ldisk1&lt;/span&gt;&lt;span class="nc"&gt;.dsk&lt;/span&gt; &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;lda1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt; &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="p"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;share&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nt"&gt;LD-I-UNIT&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;Allocated&lt;/span&gt; &lt;span class="nt"&gt;device&lt;/span&gt; &lt;span class="nt"&gt;is&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nt"&gt;1&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nt"&gt;LDA1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;ld&lt;/span&gt; &lt;span class="nt"&gt;show&lt;/span&gt; &lt;span class="nt"&gt;lda1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nt"&gt;LD-I-CONNECTED&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;Connected&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nt"&gt;1&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nt"&gt;LDA1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;to&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nt"&gt;1&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nt"&gt;dga200&lt;/span&gt;&lt;span class="nd"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;repository&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="nd"&gt;ldisk1&lt;/span&gt;&lt;span class="nc"&gt;.dsk&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;&lt;span class="nt"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Initialize the logical drive with &lt;code&gt;/erase&lt;/code&gt; parameter in order to erase any
potentially sensitive data on the underlying disk&amp;nbsp;device.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;&amp;gt; initialize /erase lda1: ldisk1_label&lt;/span&gt;
&lt;span class="x"&gt;&amp;gt; mount /over=id lda1:&lt;/span&gt;
&lt;span class="x"&gt;&amp;gt; show dev lda1&lt;/span&gt;

&lt;span class="x"&gt;Device Device Error Volume Free Trans Mnt&lt;/span&gt;
&lt;span class="x"&gt;Name Status Count Label Blocks Count Cnt&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;1&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;LDA1&lt;/span&gt;&lt;span class="x"&gt;: (MIKO) Mounted alloc 0 LDISK1 99900 1 1&lt;/span&gt;

&lt;span class="x"&gt;&amp;gt; dismount lda1:&lt;/span&gt;
&lt;span class="x"&gt;&amp;gt; ld disconnect lda1: /log&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Set the logical disk to mount automatically during&amp;nbsp;startup&lt;/p&gt;
&lt;p&gt;As previously done for the &lt;span class="caps"&gt;LD&lt;/span&gt; driver startup, we can add the commands for
connecting and mounting the logical disks, provided that they were
successfully&amp;nbsp;created.&lt;/p&gt;
&lt;p&gt;This is an example of all the lines added to the end of
&lt;code&gt;SYS$STARTUP:SYSTARTUP_VMS.COM&lt;/code&gt;:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;!&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt; If f&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sys$startup:ld$startup.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="x"&gt; .nes. Then @SYS&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;STARTUP&lt;/span&gt;&lt;span class="x"&gt;:LD&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;STARTUP&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;!&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;! Optional: for Logical Magnetic tapes (LM)&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;! If f&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sys$startup:lm$startup.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="x"&gt; .nes. &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;! Then&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;! @SYS&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;STARTUP&lt;/span&gt;&lt;span class="x"&gt;:LM&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;STARTUP&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;! Endif&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;!&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt; If f&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dsa4:[000000]SCRIPT_LD.DSK&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="x"&gt; .nes. &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt; Then&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt; ld connect dsa4:[000000]SCRIPT_LD.DSK lda1: /share&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt; mount &lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;1&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;lda1&lt;/span&gt;&lt;span class="x"&gt;: SCRIPT_LD /system /cluster&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt; Endif&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;!&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt; If f&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dsa4:[000000]T4$DATA.DSK&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="x"&gt; .nes. &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt; Then&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt; ld connect dsa4:[000000]T4&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;DATA&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;DSK&lt;/span&gt;&lt;span class="x"&gt; lda2: /share&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt; mount &lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;1&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;lda2&lt;/span&gt;&lt;span class="x"&gt;: T4&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;DATA&lt;/span&gt;&lt;span class="x"&gt; /system /cluster&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt; Endif&lt;/span&gt;
&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="x"&gt;!&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;

&lt;/li&gt;
&lt;/ul&gt;</summary><category term="OpenVMS"></category></entry><entry><title>Bypassing DNS assigned by VPN</title><link href="http://fernandezcuesta.github.io/bypassing-dns-assigned-by-vpn.html" rel="alternate"></link><updated>2014-10-14T00:00:00+02:00</updated><author><name>J.M. Fernández</name></author><id>tag:fernandezcuesta.github.io,2014-10-14:bypassing-dns-assigned-by-vpn.html</id><summary type="html">&lt;p&gt;With some &lt;span class="caps"&gt;VPN&lt;/span&gt; clients like Cisco Anyconnect, the &lt;span class="caps"&gt;DNS&lt;/span&gt; records can be
automatically assigned by the &lt;span class="caps"&gt;VPN&lt;/span&gt; server during negotiation of the secure&amp;nbsp;connection.&lt;/p&gt;
&lt;p&gt;This shouldn&amp;rsquo;t be a problem if we have access to &lt;code&gt;/etc/resolv.conf&lt;/code&gt; file. For
example enabling the immutable flag (&lt;code&gt;chattr +i /etc/resolv.conf&lt;/code&gt;) before
connecting or doing a backup&amp;amp;restore of such&amp;nbsp;file.&lt;/p&gt;
&lt;p&gt;However Anyconnect client temporarily modifies this file during initialization
&lt;em&gt;and&lt;/em&gt; monitors it, so changes are not possible without dropping the&amp;nbsp;connection.&lt;/p&gt;
&lt;p&gt;Fast an easy way to do this with iptables: redirect all &lt;span class="caps"&gt;DNS&lt;/span&gt; queries (on port
53) to our preferred or local &lt;span class="caps"&gt;DNS&lt;/span&gt; server.
For&amp;nbsp;example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;iptables -t nat -A OUTPUT -p udp --dport &lt;span class="m"&gt;53&lt;/span&gt; -j DNAT --to 8.8.8.8:53
&lt;span class="nv"&gt;$ &lt;/span&gt;iptables -t nat -A OUTPUT -p tcp --dport &lt;span class="m"&gt;53&lt;/span&gt; -j DNAT --to 8.8.8.8:53
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now, all &lt;span class="caps"&gt;DNS&lt;/span&gt; queries will be redirected to our preferred &lt;span class="caps"&gt;DNS&lt;/span&gt;, regardless of
what&amp;rsquo;s imposed by Cisco client on our &lt;code&gt;/etc/resolv.conf&lt;/code&gt; file.&lt;/p&gt;</summary><category term="security"></category><category term="networking"></category><category term="linux"></category><category term="iptables"></category></entry><entry><title>load “”</title><link href="http://fernandezcuesta.github.io/load.html" rel="alternate"></link><updated>2014-10-13T00:00:00+02:00</updated><author><name>J.M. Fernández</name></author><id>tag:fernandezcuesta.github.io,2014-10-13:load.html</id><summary type="html">&lt;p&gt;And 20min&amp;nbsp;later&amp;hellip;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Hello&amp;nbsp;world!&lt;/p&gt;
&lt;/blockquote&gt;</summary><category term="misc"></category></entry></feed>