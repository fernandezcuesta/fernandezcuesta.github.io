<!doctype html>
<html class="no-js" lang="en"><head><meta charset="utf-8"><meta http-equiv="Content-type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>sys$notes &middot; Combining pandas&nbsp;dataframes</title><link rel="shortcut icon" href="./theme/images/favicon.ico" type="image/x-icon"><meta name="author" content="J.M. Fernández"><script async src="./theme/js/jquery.min.js"></script><script async src="./theme/js/bootstrap.min.js"></script><script async src="./theme/js/respond.min.js"></script><script async src="./theme/js/modernizr-2.8.3-respond-1.4.2.min.js"></script></head><body><!--[if lt IE 8]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
  <![endif]--><nav class="navbar navbar-static-top"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="navbar-collapse collapse"><header><div class="col-xs-5 col-md-6 col-lg-6 header_box"><ul><li class="headsubtitle">yet another personal blog</li><li class="headtitle"><a href="."><img src="./theme/images/title.png" alt="sys$notes"></a></li></ul></div><div class="col-xs-6 col-md-5 col-lg-5 header_controls"><ul id="nav"><li><a href=".">Home</a></li><li><a href="./archives.html">Archives</a></li><li><a href="https://about.me/fernandez.cuesta">About</a></li><li><a class="social" href="https://plus.google.com/+JMFernándezC"><i class="fa fa-google-plus-square fa-2x" title="google-plus"></i></a><a class="social" href="https://github.com/fernandezcuesta/"><i class="fa fa-github-square fa-2x" title="github"></i></a></li></ul><div class="row navbar-header navbar-right" id="searchbox"><form action="search.html"><input type="search" name="q" id="tipue_search_input" autocomplete="off" required placeholder="search" autofocus></form></div></div></header></div></nav><div class="container"><div id="content"><div class="row post"><aside class="izquierda col-xs-2 col-md-2 col-lg-2"><div class="date"><div class="dateday">07 Nov</div><div class="datemonth">2014</div></div><div class="tags"><ul><li><a href="./tag/python.html">python</a></li><li><a href="./tag/pandas.html">pandas</a></li><li><a href="./tag/code.html">code</a></li></ul></div></aside><article class="derecha col-xs-10 col-md-10 col-lg-10"><header><h1 class="title"><a href="javascript:javascript:history.go(-1)" rel="bookmark" title="Combining pandas dataframes">Combining pandas&nbsp;dataframes</a></h1></header><section class="post_content"><p>Although still touching bases with pandas I came across a problem whose answer was not found after skimming through Wes McKinney&#8217;s <a href="http://www.bookdepository.com/Python-for-Data-Analysis-Wes-McKinney/9781449319793"><em>&#8220;Python for Data Analysis&#8221;</em></a>&nbsp;book.</p><p>Long story short, starting with a bunch of <span class="caps">CSV</span> files transferred from a remote system, a series of dataframes are produced one corresponding to each file. These CSVs may contain hetereogeneous information from different components, not necessarily for the very same&nbsp;period.</p><p>As an example, let&#8217;s assume the index being the sample indicator. For simplicity all the tests are done with these&nbsp;dataframes:</p><div class="highlight"><pre><span></span><span class="n">df_a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;sample_nr&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                     <span class="s1">&#39;val0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
                     <span class="s1">&#39;val1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
<span class="n">df_a</span> <span class="o">=</span> <span class="n">df_a</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;sample_nr&#39;</span><span class="p">)</span>

<span class="n">df_b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;sample_nr&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
                     <span class="s1">&#39;val2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                     <span class="s1">&#39;val3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]})</span>
<span class="n">df_b</span> <span class="o">=</span> <span class="n">df_b</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;sample_nr&#39;</span><span class="p">)</span>

<span class="n">df_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;sample_nr&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
                     <span class="s1">&#39;val0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                     <span class="s1">&#39;val1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]})</span>
<span class="n">df_c</span> <span class="o">=</span> <span class="n">df_c</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;sample_nr&#39;</span><span class="p">)</span>

<span class="n">df_d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;sample_nr&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                     <span class="s1">&#39;val2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
                     <span class="s1">&#39;val3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]})</span>
<span class="n">df_d</span> <span class="o">=</span> <span class="n">df_d</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;sample_nr&#39;</span><span class="p">)</span>
</pre></div><p>Which has as&nbsp;result:</p><div class="highlight"><pre><span></span><span class="n">df_a</span><span class="o">:</span>                         <span class="n">df_b</span><span class="o">:</span>
           <span class="n">val0</span>  <span class="n">val1</span>                   <span class="n">val2</span>  <span class="n">val3</span>
<span class="n">sample_nr</span>                    <span class="n">sample_nr</span>  
<span class="mi">0</span>             <span class="mi">2</span>     <span class="mi">1</span>    <span class="mi">10</span>            <span class="mi">5</span>     <span class="mi">4</span>
<span class="mi">1</span>             <span class="mi">3</span>     <span class="mi">2</span>    <span class="mi">11</span>            <span class="mi">4</span>     <span class="mi">4</span>
<span class="mi">2</span>             <span class="mi">6</span>     <span class="mi">4</span>    <span class="mi">12</span>            <span class="mi">5</span>     <span class="mi">6</span>
<span class="mi">3</span>             <span class="mi">8</span>     <span class="mi">3</span>    <span class="mi">13</span>            <span class="mi">5</span>     <span class="mi">6</span>


<span class="n">df_c</span><span class="o">:</span>                    <span class="n">df_d</span><span class="o">:</span>
           <span class="n">val0</span>  <span class="n">val1</span>               <span class="n">val2</span>  <span class="n">val3</span>
<span class="n">sample_nr</span>                <span class="n">sample_nr</span>
<span class="mi">10</span>            <span class="mi">1</span>     <span class="mi">0</span>    <span class="mi">0</span>             <span class="mi">8</span>     <span class="mi">4</span>
<span class="mi">11</span>            <span class="mi">3</span>     <span class="mi">2</span>    <span class="mi">1</span>             <span class="mi">8</span>     <span class="mi">4</span>
<span class="mi">12</span>            <span class="mi">2</span>     <span class="mi">3</span>    <span class="mi">2</span>             <span class="mi">7</span>     <span class="mi">6</span>
<span class="mi">13</span>            <span class="mi">1</span>     <span class="mi">4</span>    <span class="mi">3</span>             <span class="mi">7</span>     <span class="mi">6</span>
</pre></div><p>The result of glueing everything together&nbsp;is:</p><ul><li><p>{df_a, df_c} and {df_d, df_b} are concatenated along their axis (as the result of <code>df_a.merge(df_c, how='outer')</code>).</p></li><li><p>{df_a, df_d} and {df_c, df_b} are put together horizontally, as we could get by running <code>df_a.join(df_d)</code>.</p></li></ul><p>But&#8230;<strong>what if</strong> we have not a-priori clue of how each operands look like and would like to perform a &#8220;glue <em>all together now</em>&#8221;&nbsp;operation?</p><h1>&lt;tl;dr/&gt;</h1><p>At this point, I found two&nbsp;options:</p><ol><li>Using <code>pd.concat</code> function.</li><li>Using <code>pd.combine_first</code> function.</li></ol><p>The latter was at first glance the simplest&nbsp;choice:</p><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">_df</span> <span class="ow">in</span> <span class="p">[</span><span class="n">df_a</span><span class="p">,</span> <span class="n">df_b</span><span class="p">,</span> <span class="n">df_c</span><span class="p">,</span> <span class="n">df_d</span><span class="p">]:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">_df</span><span class="p">)</span>
</pre></div><p>which produces the desired&nbsp;output:</p><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">:</span>
           <span class="n">val0</span>  <span class="n">val1</span>  <span class="n">val2</span>  <span class="n">val3</span>
<span class="n">sample_nr</span>
<span class="mi">0</span>             <span class="mi">2</span>     <span class="mi">1</span>     <span class="mi">8</span>     <span class="mi">4</span>
<span class="mi">1</span>             <span class="mi">3</span>     <span class="mi">2</span>     <span class="mi">8</span>     <span class="mi">4</span>
<span class="mi">2</span>             <span class="mi">6</span>     <span class="mi">4</span>     <span class="mi">7</span>     <span class="mi">6</span>
<span class="mi">3</span>             <span class="mi">8</span>     <span class="mi">3</span>     <span class="mi">7</span>     <span class="mi">6</span>
<span class="mi">10</span>            <span class="mi">1</span>     <span class="mi">0</span>     <span class="mi">5</span>     <span class="mi">4</span>
<span class="mi">11</span>            <span class="mi">3</span>     <span class="mi">2</span>     <span class="mi">4</span>     <span class="mi">4</span>
<span class="mi">12</span>            <span class="mi">2</span>     <span class="mi">3</span>     <span class="mi">5</span>     <span class="mi">6</span>
<span class="mi">13</span>            <span class="mi">1</span>     <span class="mi">4</span>     <span class="mi">5</span>     <span class="mi">6</span>
</pre></div><p>The first option was, however, my choice due to the way that input data is&nbsp;obtained:</p><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dataframize</span><span class="p">(</span><span class="n">a_file</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div><p>Where <code>dataframize</code> simply takes an input <span class="caps">CSV</span> and returns a pd.DataFrame() object. The outcome still needs some adjustment (indices are duplicate and half of the values are&nbsp;empty).</p><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">:</span>
           <span class="n">val0</span>  <span class="n">val1</span>  <span class="n">val2</span>  <span class="n">val3</span>
<span class="n">sample_nr</span>
<span class="mi">0</span>             <span class="mi">2</span>     <span class="mi">1</span>   <span class="kc">NaN</span>   <span class="kc">NaN</span>
<span class="mi">1</span>             <span class="mi">3</span>     <span class="mi">2</span>   <span class="kc">NaN</span>   <span class="kc">NaN</span>
<span class="mi">2</span>             <span class="mi">6</span>     <span class="mi">4</span>   <span class="kc">NaN</span>   <span class="kc">NaN</span>
<span class="mi">3</span>             <span class="mi">8</span>     <span class="mi">3</span>   <span class="kc">NaN</span>   <span class="kc">NaN</span>
<span class="mi">0</span>           <span class="kc">NaN</span>   <span class="kc">NaN</span>     <span class="mi">8</span>     <span class="mi">4</span>
<span class="mi">1</span>           <span class="kc">NaN</span>   <span class="kc">NaN</span>     <span class="mi">8</span>     <span class="mi">4</span>
<span class="mi">2</span>           <span class="kc">NaN</span>   <span class="kc">NaN</span>     <span class="mi">7</span>     <span class="mi">6</span>
<span class="mi">3</span>           <span class="kc">NaN</span>   <span class="kc">NaN</span>     <span class="mi">7</span>     <span class="mi">6</span>
<span class="mi">10</span>            <span class="mi">1</span>     <span class="mi">0</span>   <span class="kc">NaN</span>   <span class="kc">NaN</span>
<span class="mi">11</span>            <span class="mi">3</span>     <span class="mi">2</span>   <span class="kc">NaN</span>   <span class="kc">NaN</span>
<span class="mi">12</span>            <span class="mi">2</span>     <span class="mi">3</span>   <span class="kc">NaN</span>   <span class="kc">NaN</span>
<span class="mi">13</span>            <span class="mi">1</span>     <span class="mi">4</span>   <span class="kc">NaN</span>   <span class="kc">NaN</span>
<span class="mi">10</span>          <span class="kc">NaN</span>   <span class="kc">NaN</span>     <span class="mi">5</span>     <span class="mi">4</span>
<span class="mi">11</span>          <span class="kc">NaN</span>   <span class="kc">NaN</span>     <span class="mi">4</span>     <span class="mi">4</span>
<span class="mi">12</span>          <span class="kc">NaN</span>   <span class="kc">NaN</span>     <span class="mi">5</span>     <span class="mi">6</span>
<span class="mi">13</span>          <span class="kc">NaN</span>   <span class="kc">NaN</span>     <span class="mi">5</span>     <span class="mi">6</span>
</pre></div><p>So at the end this was the code&nbsp;used:</p><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dataframize</span><span class="p">(</span><span class="n">a_file</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># properly merge the columns and restore the metadata</span>
<span class="n">_df</span> <span class="o">=</span> <span class="n">_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
</pre></div><p>The real reason of why choosing this and not <code>pd.combine_first</code>&#8230; maybe in a future&nbsp;post.</p></section><footer><div class="clear"></div><div class="row"><div class="col-xs-3 col-md-2 col-lg-2 archives izquierda"></div><div class="col-xs-8 col-md-9 col-lg-9 post archives"><a class="more" href="javascript:javascript:history.go(-1)">&#8672;&nbsp;BACK&nbsp;&#8672;</a></div></div></footer></article></div><div class="comments"><div class="row post"><div class="col-xs-10 col-md-10 col-lg-10 comments_content comments_header"><h2>Leave your comments:</h2></div><div class="col-xs-2 col-md-2 col-lg-2 comments_corner"></div></div><div class="row flex-row"><div class="col-xs-10 col-md-10 col-lg-10 comments_content"><div id="disqus_thread"><script type="text/javascript">
                       var disqus_identifier = "combining-pandas-dataframes.html";
                       (function() {
                       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                       dsq.src = 'http://vt100.disqus.com/embed.js';
                       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                      })();
                    </script></div></div><div class="comments_side"></div></div></div><div class="spacer"></div><div class="clear"></div></div><footer class="row"><div class="license_img"><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons Attribution 4.0 International License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a></div><div class="license"><div><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><strong>sys$notes</strong></span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></div><div><p>Proudly powered by <a href="http://getpelican.com">Pelican</a>&nbsp;&middot;&nbsp;Calepin theme</p></div></div></footer><div class="clear"></div></div><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-56464775-1', 'auto');  // Replace with your property ID.
ga('send', 'pageview');

</script></body><link rel="stylesheet" href="./theme/css/bootstrap.min.css" type="text/css"><link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"><link rel="stylesheet" href="./theme/css/calepin.min.css?792686df"></html>